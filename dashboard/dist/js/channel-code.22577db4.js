(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["channel-code"],{"06c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("fb6a"),a("d3b7"),a("b0c0"),a("a630"),a("3ca3"),a("ac1f");var i=a("6b75");function s(e,t){if(e){if("string"===typeof e)return Object(i["a"])(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(i["a"])(e,t):void 0}}},2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a("6b75");function s(e){if(Array.isArray(e))return Object(i["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function n(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var o=a("06c5");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e){return s(e)||n(e)||Object(o["a"])(e)||l()}},"2a72":function(e,t,a){},"2ee5":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"g",(function(){return n})),a.d(t,"e",(function(){return o})),a.d(t,"f",(function(){return l})),a.d(t,"a",(function(){return r})),a.d(t,"i",(function(){return c})),a.d(t,"h",(function(){return m})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"l",(function(){return p})),a.d(t,"k",(function(){return h})),a.d(t,"j",(function(){return g}));var i=a("b775");function s(e){return Object(i["b"])({url:"/channelCodeGroup/index",method:"get",params:e})}function n(e){return Object(i["b"])({url:"/channelCodeGroup/update",method:"put",data:e})}function o(e){return Object(i["b"])({url:"/channelCodeGroup/store",method:"post",data:e})}function l(e){return Object(i["b"])({url:"/channelCodeGroup/move",method:"put",data:e})}function r(e){return Object(i["b"])({url:"/channelCode/store",method:"post",data:e})}function c(e){return Object(i["b"])({url:"/channelCode/update",method:"put",data:e})}function m(e){return Object(i["b"])({url:"/channelCode/index",method:"get",params:e})}function d(e){return Object(i["b"])({url:"/channelCode/contact",method:"get",params:e})}function u(e){return Object(i["b"])({url:"/channelCode/show",method:"get",params:e})}function p(e){return Object(i["b"])({url:"/channelCode/statisticsIndex",method:"get",params:e})}function h(e){return Object(i["b"])({url:"/channelCode/statistics",method:"get",params:e})}function g(e){return Object(i["b"])({url:"/workDepartment/index",method:"get",params:e})}},3816:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"wrapper"},[i("div",{staticClass:"lists",attrs:{split:!1}},[i("a-alert",{attrs:{"show-icon":!1,message:"1、可以生成带参数的二维码名片，支持活码功能，即随机选取设置的活码成员推给用户。加企业微信为好友后，可以给微信联系人自动回复相应欢迎消息和打标签。",banner:""}}),i("a-alert",{attrs:{"show-icon":!1,message:"2、每创建一个渠道活码，该码则自动进入【内容引擎】--【图片类型】--分组【渠道码-企业微信】，以素材的方式通过聊天侧边栏快速发送给客户。",banner:""}}),i("a-alert",{attrs:{"show-icon":!1,message:"3、受限于官方，单人类型的渠道码创建后尽量不要再修改成员，否则会造成列表中，该二维码中间的头像与配置的成员头像不一致，但是并不影响功能使用。",banner:""}}),i("a-alert",{attrs:{"show-icon":!1,message:"4、如果企业在企业微信后台为相关成员配置了可用的欢迎语，使用第三方系统配置欢迎语，则均不起效，推送的还是企业微信官方的。",banner:""}})],1),i("a-card",[i("a-form",{attrs:{"label-col":{span:7},"wrapper-col":{span:14}}},[i("a-row",{attrs:{gutter:16}},[i("a-col",{attrs:{lg:8}},[i("a-form-item",{attrs:{label:"名称："}},[i("a-input",{attrs:{placeholder:"搜索活码名称"},model:{value:t.screentData.name,callback:function(e){t.$set(t.screentData,"name",e)},expression:"screentData.name"}})],1)],1),i("a-col",{attrs:{lg:8}},[i("a-form-item",{attrs:{label:"活码类型："}},[i("a-select",{model:{value:t.screentData.type,callback:function(e){t.$set(t.screentData,"type",e)},expression:"screentData.type"}},t._l(t.typeList,(function(e){return i("a-select-option",{key:e.value},[t._v(" "+t._s(e.label)+" ")])})),1)],1)],1),i("a-col",{attrs:{lg:8}},[i("a-form-item",{attrs:{label:"分组："}},[i("a-select",{model:{value:t.screentData.groupId,callback:function(e){t.$set(t.screentData,"groupId",e)},expression:"screentData.groupId"}},t._l(t.groupList,(function(e){return i("a-select-option",{key:e.groupId},[t._v(" "+t._s(e.name)+" ")])})),1)],1)],1)],1)],1),i("div",{staticClass:"search"},[i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@search",expression:"'/channelCode/index@search'"}],staticStyle:{marginRight:"10px"},attrs:{type:"primary"},on:{click:t.getTableData}},[t._v("查询")]),i("a-button",{on:{click:function(){e.screentData={}}}},[t._v("重置")])],1),i("div",{staticClass:"btn-box"},[i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@editGroup",expression:"'/channelCode/index@editGroup'"}],attrs:{type:"primary"},on:{click:function(){e.editGroupDis=!0}}},[t._v("修改分组")]),i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@add",expression:"'/channelCode/index@add'"}],attrs:{type:"primary"},on:{click:function(){e.addGroupDis=!0}}},[t._v("新建分组")]),i("router-link",{attrs:{to:{path:"/channelCode/store"}}},[i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/store",expression:"'/channelCode/store'"}],attrs:{type:"primary"}},[t._v("+新建")])],1)],1),i("a-table",{staticStyle:{marginTop:"20px"},attrs:{bordered:"",columns:t.columns,"data-source":t.tableData,rowKey:function(e){return e.channelCodeId},pagination:t.pagination},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"image",fn:function(e,a){return i("div",{staticClass:"img-box"},[i("img",{staticStyle:{width:"90px",height:"auto"},attrs:{src:a.qrcodeUrl,alt:""}}),i("span",[t._v(t._s(a.type))])])}},{key:"tags",fn:function(e,a){return i("div",{},t._l(a.tags,(function(e,s){return 0!==a.tags.length?i("div",{key:s+"lseg"},[t._v(t._s(e))]):t._e()})),0)}},{key:"action",fn:function(e,a){return i("div",{},[[i("router-link",{attrs:{to:{path:"/channelCode/store?channelCodeId="+a.channelCodeId}}},[i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@edit",expression:"'/channelCode/index@edit'"}],attrs:{type:"link"}},[t._v("编辑")])],1),i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@customer",expression:"'/channelCode/index@customer'"}],attrs:{type:"link"},on:{click:function(e){return t.getChannelCodeContact(a.channelCodeId)}}},[t._v("客户")]),i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@download",expression:"'/channelCode/index@download'"}],attrs:{type:"link"}},[i("a",{attrs:{href:a.qrcodeUrl,download:""}},[t._v("下载")])]),i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/index@move",expression:"'/channelCode/index@move'"}],attrs:{type:"link"},on:{click:function(e){return t.moveGroup(a.channelCodeId,a.groupId)}}},[t._v("移动")]),i("router-link",{attrs:{to:{path:"/channelCode/statistics?channelCodeId="+a.channelCodeId}}},[i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/statistics",expression:"'/channelCode/statistics'"}],attrs:{type:"link"}},[t._v("统计")])],1)]],2)}}])})],1),i("a-modal",{attrs:{width:"800px",title:"扫码客户",visible:t.contactModal},on:{cancel:function(){e.contactModal=!1,e.contactPagination.current=1}}},[i("a-table",{staticStyle:{marginTop:"20px"},attrs:{bordered:"",columns:t.contactColumns,"data-source":t.contactTableData,rowKey:function(e){return e.contactId},pagination:t.contactPagination},on:{change:t.handleTableChangeContact}}),i("template",{slot:"footer"},[i("a-button",{attrs:{type:"primary"},on:{click:function(){e.contactModal=!1,e.contactPagination.current=1}}},[t._v("确定")])],1)],2),i("a-modal",{attrs:{title:"新建分组",visible:t.addGroupDis},on:{cancel:function(){e.addGroupDis=!1,e.groupName=""}}},[i("a-form-model",{attrs:{"label-col":{span:6},"wrapper-col":{span:14}}},[i("a-form-model-item",{attrs:{label:"分组名称："}},[i("p",[t._v("每个分组名称最多15个字。同时新建多个分组时，请用“空格”隔开")]),i("a-input",{model:{value:t.groupName,callback:function(e){t.groupName=e},expression:"groupName"}})],1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.addGroupDis=!1,e.groupName=""}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.addGroup}},[t._v("确定")])],1)],2),i("a-modal",{attrs:{title:"修改分组",visible:t.editGroupDis},on:{cancel:function(){e.editGroupDis=!1,e.editGroupData={}}}},[i("a-form-model",{attrs:{"label-col":{span:6},"wrapper-col":{span:14}}},[i("a-form-model-item",{attrs:{label:"选择分组："}},[i("a-select",{model:{value:t.editGroupData.groupId,callback:function(e){t.$set(t.editGroupData,"groupId",e)},expression:"editGroupData.groupId"}},t._l(t.groupList,(function(e){return i("a-select-option",{key:e.groupId},[t._v(" "+t._s(e.name)+" ")])})),1)],1),i("a-form-model-item",{attrs:{label:"修改分组名称："}},[i("a-input",{model:{value:t.editGroupData.name,callback:function(e){t.$set(t.editGroupData,"name",e)},expression:"editGroupData.name"}})],1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.editGroupDis=!1,e.editGroupData={}}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.editGroup}},[t._v("确定")])],1)],2),i("div",{ref:"mbox",staticClass:"mbox"}),i("a-modal",{staticClass:"move-box",attrs:{getContainer:function(){return t.$refs.mbox},title:"移动分组",visible:t.moveGroupDis},on:{cancel:function(){e.moveGroupDis=!1}}},[i("div",{staticClass:"group-box"},t._l(t.groupList,(function(e){return i("div",{key:e.groupId,class:t.moveGroupId==e.groupId?"active":"",on:{click:function(a){return t.changeGroup(e.groupId)}}},[t._v(" "+t._s(e.name)+" ")])})),0),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.moveGroupDis=!1,e.moveGroupData={}}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.moveGroupDefined}},[t._v("确定")])],1)],2)],1)},s=[],n=(a("b0c0"),a("ac1f"),a("1276"),a("5319"),a("a630"),a("3ca3"),a("d3b7"),a("6062"),a("ddb0"),a("d81d"),a("2ee5")),o={data:function(){return{channelCodeId:"",editGroupDis:!1,addGroupDis:!1,visible:!1,btnLoading:!1,contactModal:!1,moveGroupDis:!1,columns:[{align:"center",title:"二维码",dataIndex:"image",scopedSlots:{customRender:"image"}},{align:"center",title:"名称",dataIndex:"name"},{align:"center",title:"分组",dataIndex:"groupName"},{align:"center",title:"客户数",dataIndex:"contactNum"},{align:"center",title:"标签",dataIndex:"tags",scopedSlots:{customRender:"tags"}},{align:"center",title:"自动添加好友",dataIndex:"autoAddFriend"},{align:"center",title:"操作",width:"250px",dataIndex:"action",scopedSlots:{customRender:"action"}}],tableData:[],pagination:{total:0,current:1,pageSize:10,showSizeChanger:!0},screentData:{},groupList:[],typeList:[{label:"全部",value:0},{label:"单人",value:1},{label:"多人",value:2}],contactTableData:[],contactColumns:[{align:"center",title:"客户名称",dataIndex:"name"},{align:"center",title:"归属成员",dataIndex:"employees"},{align:"center",title:"添加时间",dataIndex:"createTime"}],contactPagination:{total:0,current:1,pageSize:10,showSizeChanger:!0},groupName:"",editGroupData:{},moveGroupId:""}},created:function(){this.getTableData(),this.getGroupList()},methods:{getTableData:function(){var e=this,t={name:this.screentData.name,groupId:this.screentData.groupId,type:this.screentData.type,page:this.pagination.current,perPage:this.pagination.pageSize};Object(n["h"])(t).then((function(t){e.tableData=t.data.list,e.pagination.total=t.data.page.total}))},handleTableChange:function(e){var t=e.current,a=e.pageSize;this.pagination.current=t,this.pagination.pageSize=a,this.getTableData()},handleTableChangeContact:function(e){var t=e.current,a=e.pageSize;this.contactPagination.current=t,this.contactPagination.pageSize=a,this.getChannelCodeContact(this.channelCodeId)},getGroupList:function(){var e=this;Object(n["d"])().then((function(t){e.groupList=t.data}))},getChannelCodeContact:function(e){var t=this;this.channelCodeId=e,Object(n["b"])({channelCodeId:this.channelCodeId,page:this.contactPagination.current,perPage:this.contactPagination.pageSize}).then((function(e){t.contactModal=!0,t.contactTableData=e.data.list,t.contactPagination.total=e.data.page.total}))},addGroup:function(){var e=this,t=/\s+/g,a=this.groupName.replace(t," ").split(" "),i=!1,s=!1,o=!1;if(a.length>1){var l=Array.from(new Set(a)).length;l<a.length&&(s=!0)}a.map((function(t,a){""==t&&(o=!0),t.length>15&&(e.$message.error("每个敏感词最多15个字"),i=!0)})),i||(o?this.$message.error("请输入正确的分组名称"):s?this.$message.error("分组名称重复"):(this.btnLoading=!0,Object(n["e"])({name:a}).then((function(t){e.getGroupList(),e.addGroupDis=!1,e.groupName="",e.btnLoading=!1})).catch((function(t){e.btnLoading=!1}))))},editGroup:function(){var e=this,t=/\s+/g,a=this.editGroupData.name;void 0!=this.editGroupData.groupId?t.test(a)?this.$message.error("请输入正确的分组名称"):(this.btnLoading=!0,Object(n["g"])({groupId:this.editGroupData.groupId,name:this.editGroupData.name}).then((function(t){e.editGroupData={},e.getGroupList(),e.editGroupDis=!1,e.btnLoading=!1})).catch((function(t){e.btnLoading=!1}))):this.$message.error("请选择分组")},moveGroup:function(e,t){this.moveGroupDis=!0,this.channelCodeId=e,this.moveGroupId=t},changeGroup:function(e){this.moveGroupId=e},moveGroupDefined:function(){var e=this;Object(n["f"])({channelCodeId:this.channelCodeId,groupId:this.moveGroupId}).then((function(t){e.moveGroupDis=!1,e.moveGroupId="",e.channelCodeId="",e.getTableData()}))}}},l=o,r=(a("5e63"),a("2877")),c=Object(r["a"])(l,i,s,!1,null,"3867bd0a",null);t["default"]=c.exports},"38b7":function(e,t,a){"use strict";a.d(t,"h",(function(){return s})),a.d(t,"g",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"j",(function(){return r})),a.d(t,"e",(function(){return c})),a.d(t,"i",(function(){return m})),a.d(t,"b",(function(){return d})),a.d(t,"f",(function(){return u})),a.d(t,"d",(function(){return p}));var i=a("b775");function s(e){return Object(i["b"])({url:"/medium/index",method:"get",params:e})}function n(e){return Object(i["b"])({url:"/medium/show",method:"get",params:e})}function o(e){return Object(i["b"])({url:"/medium/store",method:"post",data:e})}function l(e){return Object(i["b"])({url:"/medium/destroy",method:"delete",data:e})}function r(e){return Object(i["b"])({url:"/medium/groupUpdate",method:"put",data:e})}function c(e){return Object(i["b"])({url:"/medium/update",method:"put",data:e})}function m(e){return Object(i["b"])({url:"/mediumGroup/index",method:"get",params:e})}function d(e){return Object(i["b"])({url:"/mediumGroup/store",method:"post",data:e})}function u(e){return Object(i["b"])({url:"/mediumGroup/update",method:"put",data:e})}function p(e){return Object(i["b"])({url:"/mediumGroup/destroy",method:"delete",data:e})}},4873:function(e,t,a){},"4f1c":function(e,t,a){"use strict";a("4873")},"51c5":function(e,t,a){},"59e4":function(e,t,a){"use strict";a.d(t,"C",(function(){return s})),a.d(t,"k",(function(){return n})),a.d(t,"i",(function(){return o})),a.d(t,"x",(function(){return l})),a.d(t,"D",(function(){return r})),a.d(t,"u",(function(){return c})),a.d(t,"f",(function(){return m})),a.d(t,"y",(function(){return d})),a.d(t,"A",(function(){return u})),a.d(t,"l",(function(){return p})),a.d(t,"t",(function(){return h})),a.d(t,"s",(function(){return g})),a.d(t,"B",(function(){return f})),a.d(t,"e",(function(){return y})),a.d(t,"c",(function(){return b})),a.d(t,"d",(function(){return v})),a.d(t,"z",(function(){return x})),a.d(t,"b",(function(){return T})),a.d(t,"w",(function(){return k})),a.d(t,"q",(function(){return I})),a.d(t,"o",(function(){return M})),a.d(t,"v",(function(){return C})),a.d(t,"a",(function(){return _})),a.d(t,"n",(function(){return L})),a.d(t,"j",(function(){return S})),a.d(t,"p",(function(){return D})),a.d(t,"g",(function(){return w})),a.d(t,"h",(function(){return N})),a.d(t,"m",(function(){return G})),a.d(t,"r",(function(){return O}));var i=a("b775");function s(e){return Object(i["b"])({url:"/workRoomGroup/index",method:"get",params:e})}function n(e){return Object(i["b"])({url:"/workRoomGroup/destroy",method:"delete",data:e})}function o(e){return Object(i["b"])({url:"/workRoomGroup/store",method:"post",data:e})}function l(e){return Object(i["b"])({url:"/workRoomGroup/update",method:"put",data:e})}function r(e){return Object(i["b"])({url:"/workRoom/index",method:"get",params:e})}function c(e){return Object(i["b"])({url:"/workRoom/syn",method:"put",data:e})}function m(e){return Object(i["b"])({url:"/workRoom/batchUpdate",method:"put",data:e})}function d(e){return Object(i["b"])({url:"/workContactRoom/index",method:"get",params:e})}function u(e){return Object(i["b"])({url:"/workEmployeeDepartment/memberIndex",method:"get",params:e})}function p(e){return Object(i["b"])({url:"/workDepartment/index",method:"get",params:e})}function h(e){return Object(i["b"])({url:"/workRoom/statisticsIndex",method:"get",params:e})}function g(e){return Object(i["b"])({url:"/workRoom/statistics",method:"get",params:e})}function f(e){return Object(i["b"])({url:"/workRoomAutoPull/index",method:"get",params:e})}function y(e){return Object(i["b"])({url:"/workRoomAutoPull/update",method:"put",data:e})}function b(e){return Object(i["b"])({url:"/workRoomAutoPull/store",method:"post",data:e})}function v(e){return Object(i["b"])({url:"/workRoomAutoPull/show",method:"get",params:e})}function x(e){return Object(i["b"])({url:"/workContactTagGroup/index",method:"get",params:e})}function T(e){return Object(i["b"])({url:"/workContactTag/store",method:"post",data:e})}function k(e){return Object(i["b"])({url:"/workContactTag/allTag",method:"get",params:e})}function I(e){return Object(i["b"])({url:"/workRoom/roomIndex",method:"get",params:e})}function M(e){return Object(i["b"])({url:"/roomTagPull/roomList",method:"get",params:e})}function C(e){return Object(i["b"])({url:"/roomTagPull/index",method:"get",params:e})}function _(e){return Object(i["b"])({url:"/roomTagPull/store",method:"POST",data:e})}function L(e){return Object(i["b"])({url:"/roomTagPull/show",method:"GET",params:e})}function S(e){return Object(i["b"])({url:"/roomTagPull/destroy",method:"DELETE",data:e})}function D(e){return Object(i["b"])({url:"/roomTagPull/remindSend",method:"GET",params:e})}function w(e){return Object(i["b"])({url:"/roomTagPull/chooseContact",method:"GET",params:e})}function N(e){return Object(i["b"])({url:"/roomTagPull/filterContact",method:"POST",data:e})}function G(e){return Object(i["b"])({url:"/roomTagPull/showContact",method:"GET",params:e})}function O(e){return Object(i["b"])({url:"/contactMessageBatchSend/showRoom",method:"GET",params:e})}},"5e63":function(e,t,a){"use strict";a("a4f7")},"6b75":function(e,t,a){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}a.d(t,"a",(function(){return i}))},"6c6c":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"j",(function(){return r})),a.d(t,"g",(function(){return c})),a.d(t,"i",(function(){return m})),a.d(t,"b",(function(){return d})),a.d(t,"h",(function(){return u})),a.d(t,"f",(function(){return p})),a.d(t,"k",(function(){return h}));var i=a("b775");function s(e){return Object(i["b"])({url:"/workContactTag/index",method:"get",params:e})}function n(e){return Object(i["b"])({url:"/workContactTag/destroy",method:"delete",data:e})}function o(e){return Object(i["b"])({url:"/workContactTag/store",method:"post",data:e})}function l(e){return Object(i["b"])({url:"/workContactTag/detail",method:"get",params:e})}function r(e){return Object(i["b"])({url:"/workContactTag/move",method:"put",data:e})}function c(e){return Object(i["b"])({url:"/workContactTag/update",method:"put",data:e})}function m(e){return Object(i["b"])({url:"/workContactTagGroup/index",method:"get",params:e})}function d(e){return Object(i["b"])({url:"/workContactTagGroup/store",method:"post",data:e})}function u(e){return Object(i["b"])({url:"/workContactTagGroup/update",method:"put",data:e})}function p(e){return Object(i["b"])({url:"/workContactTagGroup/destroy",method:"delete",data:e})}function h(e){return Object(i["b"])({url:"/workContactTag/synContactTag",method:"put",data:e})}},a4f7:function(e,t,a){},b209:function(e,t,a){"use strict";a("2a72")},b8e6:function(e,t,a){},c297:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"people-wrapper"},[a("div",{staticClass:"people-left"},[a("a-input-search",{staticClass:"add-input",attrs:{maxLength:15},on:{search:e.getDepartmentList},model:{value:e.searchKeyWords,callback:function(t){e.searchKeyWords="string"===typeof t?t.trim():t},expression:"searchKeyWords"}}),a("a-tree",{attrs:{"show-icon":"",checkable:"",replaceFields:e.replaceFields,checkStrictly:!1,"expanded-keys":e.expandedKeys,"selected-keys":e.selectedKeys,"tree-data":e.treeData},on:{check:e.onCheck,expand:e.onExpand},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}},[a("a-icon",{attrs:{slot:"folder",type:"folder-open"},slot:"folder"})],1)],1),a("div",{staticClass:"people-right"},[a("div",{staticClass:"total"},[e._v("已选择成员")]),a("ul",e._l(e.choosePeopleKey,(function(t,i){return a("li",{key:i,staticClass:"number"},[a("span",{staticClass:"title"},[e._v(e._s(t.employeeName))]),a("a-icon",{staticClass:"close",attrs:{type:"close"},on:{click:function(a){return e.deletePeople(t,i)}}})],1)})),0)])])},s=[],n=a("2909"),o=a("1da1"),l=a("5530"),r=(a("4de4"),a("d3b7"),a("a15b"),a("caad"),a("2532"),a("a434"),a("d81d"),a("0481"),a("4069"),a("159b"),a("99af"),a("96cf"),a("59e4")),c=a("5880"),m={name:"Department",props:{memberKey:{type:Array,default:function(){return[]}},isChecked:{type:Array,default:function(){return[]}}},data:function(){return{searchKeyWords:"",checkedKeys:[],replaceFields:{title:"name",key:"id",children:"son"},expandedKeys:[],selectedKeys:[],treeData:[],lastCheckdKeys:[],choosePeopleKey:[],departmentIds:[],flatAry:[],unchecked:[]}},watch:{memberKey:function(e){this.choosePeopleKey=e},choosePeopleKey:function(e){this.$emit("change",e)},isChecked:function(e){this.checkedKeys=e}},computed:Object(l["a"])({},Object(c["mapGetters"])(["corpName"])),created:function(){var e=this;this.choosePeopleKey=this.memberKey,this.checkedKeys=this.isChecked;var t=this.corpName?0:2e3;setTimeout((function(){e.getDepartmentList()}),t)},methods:{getDepartmentList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,s,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={searchKeyWords:e.searchKeyWords},t.prev=1,t.next=4,Object(r["l"])(a);case 4:i=t.sent,s=i.data,n=s.department,o=s.employee,""!==e.searchKeyWords&&e.$emit("search",o),e.department=n||[],e.employee=o||[],e.treeData=[{name:e.corpName,nameEn:"company",id:"company",slots:{icon:"folder"},son:n}],t.next=16;break;case 14:t.prev=14,t.t0=t["catch"](1);case 16:case"end":return t.stop()}}),t,null,[[1,14]])})))()},onCheck:function(e){var t=this,a=e.length,i=this.lastCheckdKeys.length,s=[],n=[];a>i?(s=e.filter((function(e){return-1==t.lastCheckdKeys.indexOf(e)&&"company"!==e})),this.getWorkDepartmentList(s.join(","))):(n=this.lastCheckdKeys.filter((function(t){return-1==e.indexOf(t)&&"company"!==t})),this.choosePeopleKey=this.choosePeopleKey.filter((function(e){return!n.includes(e.departmentId)}))),this.lastCheckdKeys=e},onExpand:function(e){this.expandedKeys=e},deletePeople:function(e,t){var a=this;this.choosePeopleKey.splice(t,1);var i=this.departmentIds[e.employeeId];i.map((function(e){var t=a.choosePeopleKey.filter((function(t){return t.departmentId==e}));if(0==t.length){var i=a.checkedKeys.indexOf("company");i>-1&&a.checkedKeys.splice(i,1),a.dealDeleteData(e),a.unchecked.map((function(e){var t=a.checkedKeys.indexOf(e);t>-1&&a.checkedKeys.splice(t,1)}))}})),0==this.choosePeopleKey.length&&(this.checkedKeys=[])},dealDeleteData:function(e){var t=this.treeData[0];this.flatAry=[],this.unchecked=[],this.flat(t.son,e);var a=this.unchecked.length;a>1&&this.filterId(this.unchecked[a-1])},filterId:function(e){var t=this;this.flatAry.filter((function(a){if(a.id==e)return t.unchecked.push(e),0!=a.parentId&&t.filterId(a.parentId),!0}))},flat:function(e,t){var a=this;e.forEach((function(e){a.flatAry.push(e),e.id==t&&(0!=e.parentId?a.unchecked=[e.id,e.parentId]:a.unchecked=[e.id]),e.son&&a.flat(e.son,t)}))},getWorkDepartmentList:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,s,o,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.departmentIds={},a.prev=1,a.next=4,Object(r["A"])({departmentIds:e});case 4:i=a.sent,s=i.data,s=s||[],t.choosePeopleKey=[].concat(Object(n["a"])(t.choosePeopleKey),Object(n["a"])(s)),o=[],l=[],t.choosePeopleKey.forEach((function(e){var a=l.indexOf(e.employeeId);a>-1?t.departmentIds[e.employeeId].push(e.departmentId):(t.departmentIds[e.employeeId]=[e.departmentId],l.push(e.employeeId),o.push(e))})),t.choosePeopleKey=o,a.next=16;break;case 14:a.prev=14,a.t0=a["catch"](1);case 16:case"end":return a.stop()}}),a,null,[[1,14]])})))()}}},d=m,u=(a("4f1c"),a("2877")),p=Object(u["a"])(d,i,s,!1,null,"393e889a",null);t["a"]=p.exports},c8eb:function(e,t,a){"use strict";a("51c5")},cd95:function(e,t,a){"use strict";a("b8e6")},d31d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"wrapper"},[i("a-card",{attrs:{title:"基础设置"}},[i("a-form-model",{ref:"baseInfoRules",attrs:{model:t.baseInfo,rules:t.baseInfoRules,"label-col":{span:2},"wrapper-col":{span:10}}},[i("a-form-model-item",{attrs:{label:"选择分组",prop:"groupId"}},[i("a-select",{model:{value:t.baseInfo.groupId,callback:function(e){t.$set(t.baseInfo,"groupId",e)},expression:"baseInfo.groupId"}},t._l(t.channelCodeGroup,(function(e){return i("a-select-option",{key:e.groupId},[t._v(t._s(e.name))])})),1)],1),i("a-form-model-item",{attrs:{label:"活码名称",prop:"name"}},[i("a-input",{attrs:{placeholder:"搜索群名称",maxLeng:30,disabled:t.isEdit},model:{value:t.baseInfo.name,callback:function(e){t.$set(t.baseInfo,"name",e)},expression:"baseInfo.name"}}),i("span",{staticStyle:{color:"red"}},[t._v("(一旦创建，不可修改)")])],1),i("a-form-model-item",{attrs:{label:"自动添加好友",prop:"autoAddFriend"}},[i("a-radio-group",{model:{value:t.baseInfo.autoAddFriend,callback:function(e){t.$set(t.baseInfo,"autoAddFriend",e)},expression:"baseInfo.autoAddFriend"}},[i("a-radio",{attrs:{value:2}},[t._v("需验证")]),i("a-radio",{attrs:{value:1}},[t._v("直接通过")])],1),i("span",{staticStyle:{color:"red"}},[t._v("（开启时，客户添加时无需企业成员确认，自动成为好友）")])],1),i("a-form-model-item",{attrs:{label:"客户标签"}},[i("div",{staticClass:"label"},[i("ul",{class:"展开"==t.btnText?"tags-wrapper":"tags-active"},t._l(t.tagList,(function(e,a){return i("li",{key:a+"标签",staticClass:"tag-item"},[i("a-button",{staticClass:"group-name",on:{click:function(a){return t.chooseTagGroup(e.groupId)}}},[t._v(t._s(e.groupName))]),i("div",{staticClass:"tag-content"},[t._l(e.list,(function(a,s){return i("a-tag",{key:s+"新建标签",staticClass:"tag",attrs:{color:1==a.isSelected?"#1890ff":""},on:{click:function(i){return t.chooseTag(e,a.tagId)}}},[t._v(t._s(a.tagName))])})),i("a-button",{staticClass:"add-new",on:{click:function(a){return t.addNewTag(e.groupId)}}},[t._v("+新建标签")])],2)],1)})),0),i("a-button",{on:{click:function(){e.tagGroupModal=!0}}},[t._v("+ 新建标签组")]),t.btnTextDis?i("a-button",{staticClass:"more-btn",attrs:{type:"link"},on:{click:t.clickMore}},[t._v(t._s(t.btnText))]):t._e()],1)])],1),i("a-modal",{attrs:{title:"新建标签",visible:t.tagModal},on:{cancel:function(){e.tagModal=!1}}},[i("a-form-model",{attrs:{"label-col":{span:4},"wrapper-col":{span:16}}},[i("a-form-model-item",{attrs:{label:"标签名称"}},[i("p",[t._v("每个标签名称最多15个字。同时新建多个标签时，请用“空格”隔开")]),i("a-input",{attrs:{placeholder:"请输入标签（不得超过15个字符）"},model:{value:t.newTagsName,callback:function(e){t.newTagsName=e},expression:"newTagsName"}})],1)],1),i("template",{slot:"footer"},[i("a-button",[t._v("取消")]),i("a-button",{attrs:{loading:t.btnLoading},on:{click:t.addGroupTags}},[t._v("确定")])],1)],2),i("a-modal",{attrs:{title:"新建标签组",visible:t.tagGroupModal},on:{cancel:function(){e.tagGroupModal=!1,e.newGroupName=""}}},[i("a-input",{attrs:{placeholder:"请输入分组名（不得超过15个字符）"},model:{value:t.newGroupName,callback:function(e){t.newGroupName=e},expression:"newGroupName"}}),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.tagGroupModal=!1,e.newGroupName=""}}},[t._v("取消")]),i("a-button",{attrs:{loading:t.btnLoading},on:{click:t.addGroup}},[t._v("确定")])],1)],2)],1),i("a-card",{staticStyle:{marginTop:"20px"},attrs:{title:"引流成员设置"}},[i("a-alert",{attrs:{type:"error","show-icon":!1,message:"扫码添加成员规则：在周期和特殊时期共存情况下，扫码优先添加特殊时期的成员",banner:""}}),i("a-form-model",{ref:"one",attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"类型"}},[i("a-radio-group",{attrs:{disabled:t.isEdit},on:{change:t.typeChange},model:{value:t.drainageEmployee.type,callback:function(e){t.$set(t.drainageEmployee,"type",e)},expression:"drainageEmployee.type"}},[i("a-radio",{attrs:{value:1}},[t._v("单人")]),i("a-radio",{attrs:{value:2}},[t._v("多人")])],1),i("span",{staticStyle:{color:"red"}},[t._v("(一旦创建,不可修改)")])],1),i("a-form-model-item",{attrs:{label:"企业成员"}},[7!==t.drainageEmployee.employees.length?i("a-button",{on:{click:function(){e.memberModal=!0}}},[t._v("+ 添加成员")]):t._e()],1),i("a-form-model-item",[i("div",{staticClass:"table"},t._l(t.weekList,(function(e){return i("div",{key:e.value},[i("div",{staticClass:"title"},[i("span",[t._v(t._s(e.label))])]),t._l(t.drainageEmployee.employees,(function(a,s){return a.week==e.value?i("div",{key:s+"表格",staticClass:"content"},[t._l(a.timeSlot,(function(e,n){return 1==t.drainageEmployee.type?i("div",{key:n+"单人表格"},[i("a-icon",{attrs:{type:"edit"},on:{click:function(e){return t.editEmployess(a,s,n)}}}),i("p",[i("span",[t._v(t._s(e.startTime))]),t._v("~"),i("span",[t._v(t._s(e.endTime))])]),"string"==typeof e.selectMembers?i("a-button",{attrs:{disabled:""}},[t._v(t._s(e.selectMembers))]):i("a-button",{attrs:{disabled:""}},[t._v(t._s(e.selectMembers.join(" ")))])],1):t._e()})),t._l(a.timeSlot,(function(e,n){return 2==t.drainageEmployee.type?i("div",{key:n+"多人表格"},[i("a-icon",{attrs:{type:"edit"},on:{click:function(e){return t.editEmployess(a,s,n)}}}),i("p",[i("span",[t._v(t._s(e.startTime))]),t._v("~"),i("span",[t._v(t._s(e.endTime))])]),i("a-tooltip",[e.selectMembers&&0!==e.selectMembers.length?i("template",{slot:"title"},[t._v(" "+t._s(e.selectMembers.join(","))+" ")]):t._e(),e.selectMembers&&0!==e.selectMembers.length?i("p",{staticClass:"name"},[i("span",[t._v(t._s(e.selectMembers.join(",")))])]):t._e()],2),e.selectDepartment&&0!==e.selectDepartment.length?i("div",{staticClass:"department"},t._l(e.selectDepartment,(function(e,a){return i("span",{key:a+"部门"},[t._v(t._s(e))])})),0):t._e()],1):t._e()}))],2):t._e()}))],2)})),0)]),i("a-form-model-item",{attrs:{label:"特殊时期"}},[i("a-radio-group",{model:{value:t.drainageEmployee.specialPeriod.status,callback:function(e){t.$set(t.drainageEmployee.specialPeriod,"status",e)},expression:"drainageEmployee.specialPeriod.status"}},[i("a-radio",{attrs:{value:1}},[t._v("开启")]),i("a-radio",{attrs:{value:2}},[t._v("关闭")])],1),i("span",{staticStyle:{color:"red",marginLeft:"10px"}},[t._v("(如遇到国家节假日或是企业自身重要日子，在特殊时期内，需要更换活码成员)")]),1==t.drainageEmployee.specialPeriod.status?i("div",[t._l(t.specialTimeList,(function(e,a){return 1==t.drainageEmployee.type?i("div",{key:a+"时期",staticClass:"special-box"},[i("a-form-model",{staticStyle:{width:"800px"},attrs:{"label-col":{span:3},"wrapper-col":{span:20}}},[i("a-form-model-item",{attrs:{label:"特殊时期"+(a+1)}},[i("div",{on:{click:function(e){return t.clickPicker(a)}}},[i("a-range-picker",{on:{change:t.changeData},model:{value:e.dataString,callback:function(a){t.$set(e,"dataString",a)},expression:"itam.dataString"}})],1),t._l(e.timeSlot,(function(e,s){return i("div",{key:s+"特殊时期列表"},["00:00"==e.startTime?i("a-row",{staticStyle:{marginLeft:"100px"}},[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,"default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,"default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:7}},[i("a-select",{attrs:{"label-in-value":""},model:{value:e.employeeSelect,callback:function(a){t.$set(e,"employeeSelect",a)},expression:"val.employeeSelect"}},t._l(t.memberList,(function(e){return i("a-select-option",{key:e.employeeId},[t._v(t._s(e.name))])})),1)],1)],1):i("div",[i("a-row",{staticStyle:{marginLeft:"100px"}},[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,valueFormat:"HH:mm"},on:{change:function(e,a){return t.changeTime(e,a,"startTime")}},model:{value:e.startTime,callback:function(a){t.$set(e,"startTime",a)},expression:"val.startTime"}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,valueFormat:"HH:mm",disabledHours:t.getDisabledHours,disabledSeconds:t.getDisabledSeconds},on:{change:function(e,a){return t.changeTime(e,a,"endTime")}},model:{value:e.endTime,callback:function(a){t.$set(e,"endTime",a)},expression:"val.endTime"}})],1),i("a-col",{attrs:{span:7}},[i("a-select",{attrs:{"label-in-value":""},model:{value:e.employeeSelect,callback:function(a){t.$set(e,"employeeSelect",a)},expression:"val.employeeSelect"}},t._l(t.memberList,(function(e){return i("a-select-option",{key:e.employeeId},[t._v(t._s(e.name))])})),1)],1)],1),i("a-button",{staticStyle:{marginLeft:"90px",color:"red"},attrs:{type:"link"},on:{click:function(e){return t.deleteSpecialTime(a,s)}}},[t._v("删除")])],1)],1)})),i("a-button",{staticStyle:{marginLeft:"90px"},attrs:{type:"link"},on:{click:function(e){return t.addSpecialTime(a)}}},[t._v("添加")]),t.specialTimeList.length>1?i("a-icon",{staticStyle:{color:"red"},attrs:{type:"delete"},on:{click:function(e){return t.deleteSpecial(a)}}}):t._e()],2)],1)],1):t._e()})),t._l(t.specialTimeList,(function(e,a){return 2==t.drainageEmployee.type?i("div",{key:a+"时期dd",staticClass:"special-box"},[i("a-form-model",{staticStyle:{width:"800px"},attrs:{"label-col":{span:3},"wrapper-col":{span:20}}},[i("a-form-model-item",{attrs:{label:"特殊时期"+(a+1)}},[i("div",{on:{click:function(e){return t.clickPicker(a)}}},[i("a-range-picker",{on:{change:t.changeData},model:{value:e.dataString,callback:function(a){t.$set(e,"dataString",a)},expression:"itam.dataString"}})],1),t._l(e.timeSlot,(function(e,s){return i("div",{key:s+"特殊时期ll"},["00:00"==e.startTime?i("div",[i("a-row",{staticStyle:{marginLeft:"100px"}},[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm","default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm","default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:7}},[e.selectMembers&&0!==e.selectMembers.length?i("span",{staticStyle:{marginRight:"5px"}},[t._v(t._s(e.selectMembers.join(" ")))]):t._e(),i("a-button",{on:{click:function(e){return t.specialMember(a,s)}}},[t._v("选择企业成员")])],1)],1),i("a-row",[[i("a-tree-select",{staticStyle:{width:"400px",marginLeft:"100px"},attrs:{"label-in-value":!1,"tree-data":t.departmentList,replaceFields:t.replaceFields,treeCheckStrictly:!0,"tree-checkable":"","search-placeholder":"Please select"},model:{value:e.departmentId,callback:function(a){t.$set(e,"departmentId",a)},expression:"val.departmentId"}})]],2)],1):i("div",[i("a-row",{staticStyle:{marginLeft:"100px"}},[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},on:{change:function(e,a){return t.changeTime(e,a,"startTime")}},model:{value:e.startTime,callback:function(a){t.$set(e,"startTime",a)},expression:"val.startTime"}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm",disabledHours:t.getDisabledHours,disabledSeconds:t.getDisabledSeconds},on:{change:function(e,a){return t.changeTime(e,a,"endTime")}},model:{value:e.endTime,callback:function(a){t.$set(e,"endTime",a)},expression:"val.endTime"}})],1),i("a-col",{attrs:{span:7}},[e.selectMembers&&0!==e.selectMembers.length?i("span",[t._v(t._s(e.selectMembers.join(" ")))]):t._e(),i("a-button",{on:{click:function(e){return t.specialMember(a,s)}}},[t._v("选择企业成员")])],1)],1),i("a-row",[[i("a-tree-select",{staticStyle:{width:"400px",marginLeft:"100px"},attrs:{"label-in-value":!1,"tree-data":t.departmentList,replaceFields:t.replaceFields,treeCheckStrictly:!0,"tree-checkable":"","search-placeholder":"Please select"},model:{value:e.departmentId,callback:function(a){t.$set(e,"departmentId",a)},expression:"val.departmentId"}})]],2),i("a-button",{staticStyle:{marginLeft:"90px",color:"red"},attrs:{type:"link"},on:{click:function(e){return t.deleteSpecialTime(a,s)}}},[t._v("删除")])],1)])})),i("a-button",{staticStyle:{marginLeft:"90px"},attrs:{type:"link"},on:{click:function(e){return t.addSpecialTime(a)}}},[t._v("添加")])],2)],1)],1):t._e()})),i("a-button",{attrs:{type:"primary",size:"small"},on:{click:t.addPeriod}},[t._v("+添加时期")])],2):t._e()],1),i("a-form-model-item",{attrs:{label:"员工添加上限："}},[i("a-radio-group",{on:{change:t.onAddMaxChange},model:{value:t.drainageEmployee.addMax.status,callback:function(e){t.$set(t.drainageEmployee.addMax,"status",e)},expression:"drainageEmployee.addMax.status"}},[i("a-radio",{attrs:{value:1}},[t._v("开启")]),i("a-radio",{attrs:{value:2}},[t._v("关闭")])],1),i("span",{staticStyle:{color:"red",marginLeft:"10px"}},[t._v("(因受官方限制，无法对动态部门的员工设置添加好友上限，只可针对指定活码成员进行设置)")]),1==t.drainageEmployee.addMax.status?i("a-table",{attrs:{columns:t.columns,"data-source":t.allMemderList,rowKey:function(e){return e.employeeId}},scopedSlots:t._u([{key:"max",fn:function(e,a){return i("div",{},[i("input",{directives:[{name:"model",rawName:"v-model",value:a.max,expression:"record.max"}],domProps:{value:a.max},on:{blur:function(e){return t.inputNum(a.max)},input:function(e){e.target.composing||t.$set(a,"max",e.target.value)}}})])}}],null,!1,2060377859)}):t._e()],1),1==t.drainageEmployee.addMax.status?i("a-form-model-item",{attrs:{label:"备用员工"}},[1==t.drainageEmployee.type?i("a-select",{on:{change:t.onChange},model:{value:t.drainageEmployee.addMax.spareEmployeeIds,callback:function(e){t.$set(t.drainageEmployee.addMax,"spareEmployeeIds",e)},expression:"drainageEmployee.addMax.spareEmployeeIds"}},t._l(t.memberList,(function(e){return i("a-select-option",{key:e.employeeId},[t._v(t._s(e.name))])})),1):i("a-button",{on:{click:function(e){return t.recordIndex(0,"备用人员")}}},[t._v("选择企业成员")])],1):t._e()],1),i("a-modal",{attrs:{width:"800px",title:"添加企业成员",visible:t.memberModal},on:{cancel:t.resetDrainage}},[i("a-alert",{attrs:{type:"warning","show-icon":!1,message:"1、系统默认生成一条每日24小时（00:00~00:00）数据，当时间点不在所新增的时段内，客户扫码后，添加的是“24小时”的企业成员。",banner:""}}),i("a-alert",{attrs:{type:"warning","show-icon":!1,message:"2、因受官方限制，无法对动态部门的员工设置添加好友上限，只可针对指定活码成员进行设置。",banner:""}}),i("a-form-model",{staticStyle:{marginTop:"20px"},attrs:{"label-col":{span:3},"wrapper-col":{span:20}}},[1==t.drainageEmployee.type?i("a-form-model-item",{attrs:{label:"固定时段"}},[t._l(t.singleTimeList,(function(e,a){return i("div",{key:a+"单人时间"},["00:00"==e.startTime?i("a-row",[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,"default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{format:"HH:mm","minute-step":60,"default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:7}},[i("a-select",{attrs:{"label-in-value":""},model:{value:e.employeeSelect,callback:function(a){t.$set(e,"employeeSelect",a)},expression:"item.employeeSelect"}},t._l(t.memberList,(function(e){return i("a-select-option",{key:e.employeeId},[t._v(t._s(e.name))])})),1)],1)],1):i("a-row",[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},on:{change:function(e,a){return t.changeTime(e,a,"startTime")}},model:{value:e.startTime,callback:function(a){t.$set(e,"startTime",a)},expression:"item.startTime"}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm",disabledHours:t.getDisabledHours,disabledSeconds:t.getDisabledSeconds},on:{change:function(e,a){return t.changeTime(e,a,"endTime")}},model:{value:e.endTime,callback:function(a){t.$set(e,"endTime",a)},expression:"item.endTime"}})],1),i("a-col",{attrs:{span:7}},[i("a-select",{attrs:{"label-in-value":""},model:{value:e.employeeSelect,callback:function(a){t.$set(e,"employeeSelect",a)},expression:"item.employeeSelect"}},t._l(t.memberList,(function(e){return i("a-select-option",{key:e.employeeId},[t._v(t._s(e.name))])})),1)],1),i("a-button",{staticStyle:{color:"red"},attrs:{type:"link"},on:{click:function(e){return t.deleteSingle(a,"单人")}}},[t._v("删除")])],1)],1)})),i("a-button",{attrs:{type:"link"},on:{click:t.addSingleTime}},[t._v("添加")])],2):i("a-form-model-item",{attrs:{label:"固定时段"}},[t._l(t.manyTimeList,(function(e,a){return i("div",{key:a+"多人添加23"},["00:00"==e.startTime?i("div",[i("a-row",[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm","default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm","default-value":t.moment("00:00","HH:mm"),disabled:""}})],1),i("a-col",{attrs:{span:7}},[e.selectMembers&&0!==e.selectMembers.length?i("span",[t._v(t._s(e.selectMembers.join(",")))]):t._e(),i("a-button",{on:{click:function(e){return t.recordIndex(a,"人员")}}},[t._v("选择企业成员")])],1)],1),[i("a-tree-select",{staticStyle:{width:"100%"},attrs:{"tree-data":t.departmentList,replaceFields:t.replaceFields,treeCheckStrictly:!0,"tree-checkable":"","search-placeholder":"Please select"},model:{value:e.departmentSelect,callback:function(a){t.$set(e,"departmentSelect",a)},expression:"val.departmentSelect"}})]],2):i("div",[i("a-row",[i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},on:{change:function(e,a){return t.changeTime(e,a,"startTime")}},model:{value:e.startTime,callback:function(a){t.$set(e,"startTime",a)},expression:"val.startTime"}})],1),i("a-col",{attrs:{span:5}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm",disabledHours:t.getDisabledHours,disabledSeconds:t.getDisabledSeconds},on:{change:function(e,a){return t.changeTime(e,a,"endTime")}},model:{value:e.endTime,callback:function(a){t.$set(e,"endTime",a)},expression:"val.endTime"}})],1),e.selectMembers&&0!==e.selectMembers.length?i("a-col",{attrs:{span:5}},[i("span",[t._v(t._s(e.selectMembers.join(" ")))])]):t._e(),i("a-col",{attrs:{span:7}},[i("a-button",{on:{click:function(e){return t.recordIndex(a,"人员")}}},[t._v("选择企业成员")])],1)],1),[i("a-tree-select",{staticStyle:{width:"100%"},attrs:{"tree-data":t.departmentList,replaceFields:t.replaceFields,treeCheckStrictly:!0,"tree-checkable":"","search-placeholder":"Please select"},model:{value:e.departmentSelect,callback:function(a){t.$set(e,"departmentSelect",a)},expression:"val.departmentSelect"}})],i("a-button",{staticStyle:{color:"red"},attrs:{type:"link"},on:{click:function(e){return t.deleteSingle(a,"多人")}}},[t._v("删除")])],2)])})),i("a-button",{attrs:{type:"link"},on:{click:t.addManyTime}},[t._v("添加")])],2),i("a-form-model-item",{attrs:{label:"适用周期"}},t._l(t.weekTagList,(function(e,a){return i("a-tag",{key:a+"esd",staticClass:"tag",attrs:{color:1==e.isChecked?"#1890ff":""},on:{click:function(a){return t.chooseWeekTag(e.id)}}},[t._v(t._s(e.name))])})),1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:t.resetDrainage}},[t._v("取消")]),i("a-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.drainageDefine}},[t._v("确定")])],1)],2),i("a-modal",{attrs:{title:"选择企业成员",maskClosable:!1,width:700,visible:t.choosePeopleShow},on:{cancel:function(e){t.choosePeopleShow=!1}}},[t.choosePeopleShow?i("Department",{attrs:{isChecked:t.employees,memberKey:t.employees},on:{change:t.peopleChange,search:t.searchEmp}}):t._e(),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.choosePeopleShow=!1,e.employeeIdList="",e.employees=[]}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:function(){e.choosePeopleShow=!1}}},[t._v("确定")])],1)],2)],1),i("a-card",{staticStyle:{marginTop:"20px"},attrs:{title:"欢迎语设置"}},[i("a-alert",{attrs:{type:"error","show-icon":!1,message:"欢迎语推送规则：在通用、周期及特殊时期欢迎语共存情况下，推送优先顺序为特殊时期的欢迎语 > 按周期的欢迎语 > 通用欢迎语。若企业微信官方后台已配置了欢迎语，则在第三方系统配置的欢迎语均失效，客户收到的依然是官方推送的。",banner:""}}),i("a-form-model",{ref:"two",attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"扫码推送："}},[i("a-radio-group",{model:{value:t.welcomeMessage.scanCodePush,callback:function(e){t.$set(t.welcomeMessage,"scanCodePush",e)},expression:"welcomeMessage.scanCodePush"}},[i("a-radio",{attrs:{value:1}},[t._v("开启")]),i("a-radio",{attrs:{value:2}},[t._v("关闭")])],1),i("span",{staticStyle:{color:"red",marginLeft:"10px"}},[t._v("(关闭后，客户扫该渠道活码，依然可对该客户自动打标签，但仅收到系统的【欢迎语】消息)")])],1)],1),1==t.welcomeMessage.scanCodePush?i("a-tabs",{attrs:{"tab-position":"left"},on:{change:t.tabChange}},[i("a-tab-pane",{key:"1",attrs:{tab:"通用欢迎语"}},[i("div",{staticClass:"box"},[i("div",{staticClass:"left"},[i("p",[t._v("客服账号")]),i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"content"},[t._v(" "+t._s(t.currencyMessage.welcomeContent)+" ")])]),2==t.mediumDetail.type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"img-box"},[i("img",{attrs:{src:t.mediumDetail.imageFullPath,alt:""}})])]):t._e(),6==t.mediumDetail.type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"applets-box"},[i("h4",[t._v(t._s(t.mediumDetail.title))]),i("img",{attrs:{src:t.mediumDetail.imageFullPath,alt:""}})])]):t._e(),3==t.mediumDetail.type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"text-box"},[i("h4",[t._v(t._s(t.mediumDetail.title))]),i("div",[t.mediumDetail.description?i("span",[t._v(t._s(t.mediumDetail.description))]):t._e(),i("img",{attrs:{src:t.mediumDetail.imageFullPath,alt:""}})])])]):t._e()]),i("div",{staticClass:"right"},[i("a-textarea",{attrs:{id:"currency",placeholder:"请输入消息内容",rows:4},model:{value:t.currencyMessage.welcomeContent,callback:function(e){t.$set(t.currencyMessage,"welcomeContent",e)},expression:"currencyMessage.welcomeContent"}}),i("a-button",{staticStyle:{marginTop:"20px",marginBottom:"20px"},attrs:{type:"primary"},on:{click:function(e){return t.insert("通用",0,0)}}},[t._v("客户名称")]),i("a-alert",{attrs:{message:"提示：火狐浏览器可能出现无法正确插入客户名称，请使用谷歌、360浏览器",type:"info"}}),void 0==t.mediumDetail.mediumTitle?i("a-popover",{staticStyle:{marginTop:"20px"}},[i("template",{slot:"content"},[i("a-button",{attrs:{icon:"file-image"},on:{click:function(e){return t.imgBoxModal("图片")}}},[t._v(" 图片 ")]),i("a-button",{attrs:{icon:"link"},on:{click:function(e){return t.imgBoxModal("图文")}}},[t._v(" 图文 ")]),i("a-button",{attrs:{icon:"paper-clip"},on:{click:function(e){return t.imgBoxModal("小程序")}}},[t._v(" 小程序 ")])],1),i("a-button",[t._v(" +添加图片/图文/小程序 ")])],2):i("div",{staticClass:"medium-btn"},[i("a-icon",{attrs:{type:"link"}}),t._v(" "),i("span",{on:{click:t.showMedium}},[t._v(t._s(t.mediumDetail.mediumTitle))]),t._v(" "),i("a-icon",{attrs:{type:"close"},on:{click:t.closeMedium}})],1)],1)])]),i("a-tab-pane",{key:"2",attrs:{tab:"周期欢迎语"}},[i("a-form-model",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"状态"}},[i("a-radio-group",{model:{value:t.cycleMessage.status,callback:function(e){t.$set(t.cycleMessage,"status",e)},expression:"cycleMessage.status"}},[i("a-radio",{attrs:{value:1}},[t._v("开启")]),i("a-radio",{attrs:{value:2}},[t._v("关闭")])],1)],1)],1),1==t.cycleMessage.status?i("a-tabs",{attrs:{type:"editable-card"},on:{edit:t.onEdit}},t._l(t.cycleMessage.detail,(function(e,a){return i("a-tab-pane",{key:"周期欢迎语"+(a+1),attrs:{tab:"欢迎语"+(a+1),closable:0!==a}},[i("a-form-model",{ref:"thr",refInFor:!0,attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[1==t.cycleMessage.status?i("a-form-model-item",{attrs:{label:"选择周期"}},t._l(t.cycleWeekTagList[a],(function(e,s){return i("a-tag",{key:s,staticClass:"tag",attrs:{color:1==e.isChecked?"#1890ff":""},on:{click:function(i){return t.cycleWeek(e.id,a)}}},[t._v(t._s(e.name))])})),1):t._e()],1),i("div",{staticStyle:{marginTop:"20px"}},[t._l(e.timeSlot,(function(s,n){return i("div",{key:n+"周期时间",staticClass:"message-box"},[i("a-form-model",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"时间段"+(n+1)}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},model:{value:s.startTime,callback:function(e){t.$set(s,"startTime",e)},expression:"val.startTime"}}),i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},model:{value:s.endTime,callback:function(e){t.$set(s,"endTime",e)},expression:"val.endTime"}}),e.timeSlot.length>1?i("a-icon",{staticStyle:{color:"red",marginLeft:"20px"},attrs:{type:"delete"},on:{click:function(e){return t.cycleDelete(a,n)}}}):t._e()],1)],1),i("div",{staticClass:"box"},[i("div",{staticClass:"left"},[i("p",[t._v("客服账号")]),i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"content"},[t._v(" "+t._s(s.welcomeContent)+" ")])]),void 0!=t.cycleMediumList[a].medium[n].type?i("div",[2==t.cycleMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"img-box"},[i("img",{attrs:{src:t.cycleMediumList[a].medium[n].imageFullPath,alt:""}})])]):t._e(),6==t.cycleMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"applets-box"},[i("h4",[t._v(t._s(t.cycleMediumList[a].medium[n].title))]),i("img",{attrs:{src:t.cycleMediumList[a].medium[n].imageFullPath,alt:""}})])]):t._e(),3==t.cycleMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"text-box"},[i("h4",[t._v(t._s(t.cycleMediumList[a].medium[n].title))]),i("div",[t.cycleMediumList[a].medium[n].description?i("span",[t._v(t._s(t.cycleMediumList[a].medium[n].description))]):t._e(),i("img",{attrs:{src:t.cycleMediumList[a].medium[n].imageFullPath,alt:""}})])])]):t._e()]):t._e()]),i("div",{staticClass:"right"},[i("a-textarea",{attrs:{id:"cycle",placeholder:"请输入消息内容",rows:4},model:{value:s.welcomeContent,callback:function(e){t.$set(s,"welcomeContent",e)},expression:"val.welcomeContent"}}),i("a-button",{staticStyle:{marginTop:"20px",marginBottom:"20px"},attrs:{type:"primary"},on:{click:function(e){return t.insert("周期",n,a)}}},[t._v("客户名称")]),i("a-alert",{attrs:{message:"提示：火狐浏览器可能出现无法正确插入客户名称，请使用谷歌、360浏览器",type:"info"}}),""==t.cycleMediumList[a].medium[n].mediumTitle||void 0==t.cycleMediumList[a].medium[n].mediumTitle?i("a-popover",{staticStyle:{marginTop:"20px"}},[i("template",{slot:"content"},[i("a-button",{attrs:{icon:"file-image"},on:{click:function(e){return t.cycleImgBoxModal("图片",a,n)}}},[t._v(" 图片 ")]),i("a-button",{attrs:{icon:"link"},on:{click:function(e){return t.cycleImgBoxModal("图文",a,n)}}},[t._v(" 图文 ")]),i("a-button",{attrs:{icon:"paper-clip"},on:{click:function(e){return t.cycleImgBoxModal("小程序",a,n)}}},[t._v(" 小程序 ")])],1),i("a-button",[t._v(" +添加图片/图文/小程序 ")])],2):i("div",{staticClass:"medium-btn"},[i("a-icon",{attrs:{type:"link"}}),t._v(" "),i("span",[t._v(t._s(t.cycleMediumList[a].medium[n].mediumTitle))]),t._v(" "),i("a-icon",{attrs:{type:"close"},on:{click:function(e){return t.cycleCloseMedium(a,n)}}})],1)],1)])],1)})),i("a-button",{staticStyle:{marginTop:"20px"},on:{click:function(e){return t.addCycleTime(a)}}},[t._v("添加时间段")])],2)],1)})),1):t._e()],1),i("a-tab-pane",{key:"3",attrs:{tab:"特殊时期欢迎语"}},[i("a-form-model",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"状态"}},[i("a-radio-group",{model:{value:t.specialMessage.status,callback:function(e){t.$set(t.specialMessage,"status",e)},expression:"specialMessage.status"}},[i("a-radio",{attrs:{value:1}},[t._v("开启")]),i("a-radio",{attrs:{value:2}},[t._v("关闭")])],1)],1)],1),1==t.specialMessage.status?i("a-tabs",{attrs:{type:"editable-card"},on:{edit:t.onEdits}},t._l(t.specialMessage.detail,(function(e,a){return i("a-tab-pane",{key:"特殊时期欢迎语"+(a+1),attrs:{tab:"欢迎语"+(a+1),closable:0!==a}},[i("div",[i("a-form-model",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"日期1"}},[i("div",{on:{click:function(e){return t.defineDateIndex(a)}}},[i("a-range-picker",{on:{change:t.specialDate},model:{value:e.dataString,callback:function(a){t.$set(e,"dataString",a)},expression:"item.dataString"}})],1)])],1),t._l(e.timeSlot,(function(s,n){return i("div",{key:n+"特殊时期时间",staticClass:"message-box"},[i("a-form-model",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[i("a-form-model-item",{attrs:{label:"时间段"+(n+1)}},[i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},model:{value:s.startTime,callback:function(e){t.$set(s,"startTime",e)},expression:"val.startTime"}}),i("a-time-picker",{attrs:{"minute-step":60,format:"HH:mm",valueFormat:"HH:mm"},model:{value:s.endTime,callback:function(e){t.$set(s,"endTime",e)},expression:"val.endTime"}}),e.timeSlot.length>1?i("a-icon",{staticStyle:{color:"red",marginLeft:"20px"},attrs:{type:"delete"},on:{click:function(e){return t.specialDelete(a,n)}}}):t._e()],1)],1),i("div",{staticClass:"box"},[i("div",{staticClass:"left"},[i("p",[t._v("客服账号")]),i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"content"},[t._v(" "+t._s(s.welcomeContent)+" ")])]),2==t.specialMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"img-box"},[i("img",{attrs:{src:t.specialMediumList[a].medium[n].imageFullPath,alt:""}})])]):t._e(),6==t.specialMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"applets-box"},[i("h4",[t._v(t._s(t.specialMediumList[a].medium[n].title))]),i("img",{attrs:{src:t.specialMediumList[a].medium[n].imageFullPath,alt:""}})])]):t._e(),3==t.specialMediumList[a].medium[n].type?i("div",{staticClass:"dialogue-box"},[i("div",{staticClass:"portrait"},[i("a-icon",{staticClass:"user",attrs:{type:"user"}})],1),i("div",{staticClass:"text-box"},[i("h4",[t._v(t._s(t.specialMediumList[a].medium[n].title))]),i("div",[t.specialMediumList[a].medium[n].description?i("span",[t._v(t._s(t.specialMediumList[a].medium[n].description))]):t._e(),i("img",{attrs:{src:t.specialMediumList[a].medium[n].imageFullPath,alt:""}})])])]):t._e()]),i("div",{staticClass:"right"},[i("a-textarea",{attrs:{id:"special",placeholder:"请输入消息内容",rows:4},model:{value:s.welcomeContent,callback:function(e){t.$set(s,"welcomeContent",e)},expression:"val.welcomeContent"}}),i("a-button",{staticStyle:{marginTop:"20px",marginBottom:"20px"},attrs:{type:"primary"},on:{click:function(e){return t.insert("特殊",n,a)}}},[t._v("客户名称")]),i("a-alert",{attrs:{message:"提示：火狐浏览器可能出现无法正确插入客户名称，请使用谷歌、360浏览器",type:"info"}}),""==t.specialMediumList[a].medium[n].mediumTitle||void 0==t.specialMediumList[a].medium[n].mediumTitle?i("a-popover",{staticStyle:{marginTop:"20px"}},[i("template",{slot:"content"},[i("a-button",{attrs:{icon:"file-image"},on:{click:function(e){return t.specialImgBoxModal("图片",a,n)}}},[t._v(" 图片 ")]),i("a-button",{attrs:{icon:"link"},on:{click:function(e){return t.specialImgBoxModal("图文",a,n)}}},[t._v(" 图文 ")]),i("a-button",{attrs:{icon:"paper-clip"},on:{click:function(e){return t.specialImgBoxModal("小程序",a,n)}}},[t._v(" 小程序 ")])],1),i("a-button",[t._v(" +添加图片/图文/小程序 ")])],2):i("div",{staticClass:"medium-btn"},[i("a-icon",{attrs:{type:"link"}}),t._v(" "),i("span",[t._v(t._s(t.specialMediumList[a].medium[n].mediumTitle))]),t._v(" "),i("a-icon",{attrs:{type:"close"},on:{click:function(e){return t.specialCloseMedium(a,n)}}})],1)],1)])],1)})),1==t.specialMessage.status?i("a-button",{on:{click:function(e){return t.addSpecialMessageTime(a)}}},[t._v("添加时间段")]):t._e()],2)])})),1):t._e()],1)],1):t._e()],1),i("div",{staticClass:"define-btn"},[i("router-link",{attrs:{to:{path:"/channelCode/index"}}},[i("a-button",[t._v("取消")])],1),i("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/channelCode/store@confirm",expression:"'/channelCode/store@confirm'"}],attrs:{size:"large",type:"primary",loading:t.btnLoading},on:{click:t.defineChannelCode}},[t._v("确定")])],1),i("div",{ref:"pbox",staticClass:"pbox"},[i("a-modal",{attrs:{getContainer:function(){return t.$refs.pbox},width:"900px",title:"选择素材",visible:t.imgModal},on:{cancel:function(){e.imgModal=!1}}},[i("a-row",{attrs:{gutter:16}},[i("a-col",{attrs:{lg:8}},[i("a-select",{staticStyle:{width:"100%"},on:{change:t.changeGroup},model:{value:t.mediumGroupId,callback:function(e){t.mediumGroupId=e},expression:"mediumGroupId"}},t._l(t.mediumGroupList,(function(e){return i("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1)],1),i("a-col",{attrs:{lg:8}},[i("a-input-search",{attrs:{placeholder:"输入要搜索的内容","enter-button":"搜索"},on:{search:t.getMaterialLibrary},model:{value:t.searchStr,callback:function(e){t.searchStr=e},expression:"searchStr"}})],1),i("a-col",{attrs:{lg:3}},[i("a-button",{on:{click:function(){e.searchStr="",e.getMaterialLibrary()}}},[t._v("清空")])],1),i("a-col",{attrs:{lg:3}},[i("a-button",{attrs:{icon:"download"},on:{click:t.uploadModal}},[t._v("本地上传")])],1)],1),2===t.mediumType?i("div",{staticClass:"picture-box"},[t.materialData&&0==t.materialData.length?i("div",{staticClass:"nothing"},[t._v(" 暂无数据 ")]):t._l(t.materialData,(function(e){return i("div",{key:e.id,class:t.mediumId===e.id?"active":null,on:{click:function(a){return t.definedMedium(e.id,e.content)}}},[i("img",{attrs:{src:e.content.imageFullPath,alt:""}}),i("span",[t._v(t._s(e.content.imageName))])])}))],2):t._e(),i("template",{slot:"footer"},[i("a-button",{on:{click:t.resetImage}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"}},[t._v("确定")])],1)],2)],1),i("div",{ref:"tbox",staticClass:"tbox"},[i("a-modal",{attrs:{width:"800px",title:"新建图片素材",getContainer:function(){return t.$refs.tbox},visible:t.localUploadModal},on:{cancel:function(){e.localUploadModal=!1}}},[i("a-form-model",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[i("a-form-model-item",{attrs:{label:"上传图片"}},[i("upload",{attrs:{imageUrl:t.imgUrl,"file-type":1},on:{success:t.uploadSuccess}}),i("p",[t._v("(图片大小不超过2M，支持JPG、JPEG及PNG格式)")])],1),i("a-form-model-item",{attrs:{label:"素材同步"}},[i("a-radio-group",{model:{value:t.isSync,callback:function(e){t.isSync=e},expression:"isSync"}},[i("a-radio",{attrs:{value:2}},[t._v("不同步")]),i("a-radio",{attrs:{value:1}},[t._v("同步至【内容引擎】")])],1),1==t.isSync?i("a-select",{staticClass:"select-box",model:{value:t.mediumGroupId,callback:function(e){t.mediumGroupId=e},expression:"mediumGroupId"}},t._l(t.mediumGroupList,(function(e){return i("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1):t._e()],1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:function(){e.localUploadModal=!1,e.imgModal=!0,e.isSync=1,e.imgUrl=""}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.uploadImage}},[t._v("确定")])],1)],2)],1),i("div",{ref:"tbox",staticClass:"tbox"},[i("a-modal",{attrs:{width:"800px",title:"图文",getContainer:function(){return t.$refs.tbox},visible:t.imageTextModal},on:{cancel:function(){e.imageTextModal=!1}}},[i("a-form-model",{ref:"imageForm",attrs:{model:t.imageTextData,rules:t.imageForm,"label-col":{span:4},"wrapper-col":{span:18}}},[i("a-form-model-item",{attrs:{label:"添加方式"}},[i("a-radio-group",{on:{change:t.importChange},model:{value:t.isImport,callback:function(e){t.isImport=e},expression:"isImport"}},[i("a-radio",{attrs:{value:0}},[t._v("新建")]),i("a-radio",{attrs:{value:1}},[t._v("导入")])],1)],1),0===t.isImport?i("div",[i("a-form-model-item",{attrs:{label:"图片封面"}},[""==t.imgUrl?i("div",{staticClass:"up-box",on:{click:function(e){return t.mediumModal("image")}}},[t._v("+")]):i("div",{staticClass:"img-box"},[i("div",{staticClass:"imgs"},[i("img",{attrs:{src:t.imgUrl,alt:""}})]),i("a-button",{attrs:{type:"link"},on:{click:function(e){return t.mediumModal("isImage")}}},[t._v("重新上传")])],1)]),i("a-form-model-item",{attrs:{label:"填写标题",prop:"title"}},[i("a-input",{attrs:{maxLength:32},model:{value:t.imageTextData.title,callback:function(e){t.$set(t.imageTextData,"title",e)},expression:"imageTextData.title"}})],1),i("a-form-model-item",{attrs:{label:"添加描述"}},[i("a-textarea",{attrs:{rows:4,placeholder:"填写图文描述",maxLength:128},model:{value:t.imageTextData.description,callback:function(e){t.$set(t.imageTextData,"description",e)},expression:"imageTextData.description"}})],1),i("a-form-model-item",{attrs:{label:"素材同步"}},[i("a-radio-group",{model:{value:t.isSync,callback:function(e){t.isSync=e},expression:"isSync"}},[i("a-radio",{attrs:{value:2}},[t._v("不同步")]),i("a-radio",{attrs:{value:1}},[t._v("同步至【内容引擎】")])],1),1==t.isSync?i("a-select",{staticClass:"select-box",model:{value:t.mediumGroupId,callback:function(e){t.mediumGroupId=e},expression:"mediumGroupId"}},t._l(t.mediumGroupList,(function(e){return i("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1):t._e()],1),i("a-form-model-item",{attrs:{label:"点击跳转",prop:"imageLink"}},[i("a-input",{attrs:{placeholder:"请输入跳转链接，且必须以http://或http://开头"},model:{value:t.imageTextData.imageLink,callback:function(e){t.$set(t.imageTextData,"imageLink",e)},expression:"imageTextData.imageLink"}})],1)],1):i("div",[i("a-form-model",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[i("a-form-model-item",{attrs:{label:"图片"}},[""==t.mediumTitle?i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.importMedium("图文")}}},[t._v("选择图文")]):i("div",{staticClass:"import-box"},[i("a-icon",{attrs:{type:"check-circle",theme:"twoTone","two-tone-color":"#52c41a"}}),i("span",[t._v("已选择1条素材")]),i("a-button",{attrs:{type:"link"},on:{click:function(){e.imageTextModal=!1,e.importModal=!0}}},[t._v("[修改]")])],1)],1)],1)],1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:function(e){return t.reset("图片")}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.addImageTextDefine}},[t._v("确定")])],1)],2)],1),i("a-modal",{attrs:{width:"800px",title:"选择素材",getContainer:function(){return t.$refs.pbox},visible:t.importModal},on:{cancel:function(){e.importModal=!1}}},[i("a-row",[i("a-col",{attrs:{lg:8}},[i("a-select",{staticStyle:{width:"100%"},on:{change:t.changeGroup},model:{value:t.mediumGroupId,callback:function(e){t.mediumGroupId=e},expression:"mediumGroupId"}},t._l(t.mediumGroupList,(function(e){return i("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1)],1),i("a-col",{attrs:{lg:8,offset:1}},[i("a-input-search",{attrs:{placeholder:"输入要搜索的内容","enter-button":"搜索"},on:{search:t.getMaterialLibrary},model:{value:t.searchStr,callback:function(e){t.searchStr=e},expression:"searchStr"}})],1),i("a-col",{attrs:{lg:3}},[i("a-button",{on:{click:function(){e.searchStr="",e.getMaterialLibrary()}}},[t._v("清空")])],1)],1),i("div",{staticClass:"picture-box"},[t.materialData&&0==t.materialData.length?i("div",{staticClass:"nothing"},[t._v(" 暂无数据 ")]):t._l(t.materialData,(function(e){return i("div",{key:e.id,class:t.mediumId===e.id?"active":null,on:{click:function(a){return t.mediumImport(e.id,e.content)}}},[i("img",{attrs:{src:e.content.imageFullPath,alt:""}}),i("span",[t._v(t._s(e.content.title))])])}))],2),i("template",{slot:"footer"},[i("a-button",{on:{click:t.resetImport}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.importDefined}},[t._v("确定")])],1)],2),i("a-modal",{attrs:{width:"800px",title:"小程序",getContainer:function(){return t.$refs.tbox},visible:t.appletsModal},on:{cancel:function(){e.appletsModal=!1}}},[i("a-form-model",{ref:"appletsForm",attrs:{model:t.appletsData,rules:t.appletsForm,"label-col":{span:4},"wrapper-col":{span:18}}},[i("a-form-model-item",{attrs:{label:"添加方式"}},[i("a-radio-group",{on:{change:t.importChange},model:{value:t.isImport,callback:function(e){t.isImport=e},expression:"isImport"}},[i("a-radio",{attrs:{value:0}},[t._v("新建")]),i("a-radio",{attrs:{value:1}},[t._v("导入")])],1)],1),0===t.isImport?i("div",[i("a-form-model-item",{attrs:{label:"图片封面"}},[""==t.imgUrl?i("div",{staticClass:"up-box",on:{click:function(e){return t.mediumModal("applets")}}},[t._v("+")]):i("div",{staticClass:"img-box"},[i("div",{staticClass:"imgs"},[i("img",{attrs:{src:t.imgUrl,alt:""}})]),i("a-button",{attrs:{type:"link"},on:{click:function(e){return t.mediumModal("isApplets")}}},[t._v("重新上传")])],1)]),i("a-form-model-item",{attrs:{label:"填写标题",prop:"title"}},[i("a-input",{attrs:{placeholder:"请填写小程序标题(4-12个字符)",maxLength:12},model:{value:t.appletsData.title,callback:function(e){t.$set(t.appletsData,"title",e)},expression:"appletsData.title"}})],1),i("a-form-model-item",{attrs:{label:"AppID",prop:"appid"}},[i("a-input",{attrs:{placeholder:"请填写小程序AppID,必须是关联到企业的小程序应用"},model:{value:t.appletsData.appid,callback:function(e){t.$set(t.appletsData,"appid",e)},expression:"appletsData.appid"}})],1),i("a-form-model-item",{attrs:{label:"page路径",prop:"page"}},[i("a-input",{attrs:{placeholder:"请填写小程序路径，例如：pages/index"},model:{value:t.appletsData.page,callback:function(e){t.$set(t.appletsData,"page",e)},expression:"appletsData.page"}})],1),i("a-form-model-item",{attrs:{label:"素材同步"}},[i("a-radio-group",{model:{value:t.isSync,callback:function(e){t.isSync=e},expression:"isSync"}},[i("a-radio",{attrs:{value:2}},[t._v("不同步")]),i("a-radio",{attrs:{value:1}},[t._v("同步至【内容引擎】")])],1),1==t.isSync?i("a-select",{staticClass:"select-box",model:{value:t.mediumGroupId,callback:function(e){t.mediumGroupId=e},expression:"mediumGroupId"}},t._l(t.mediumGroupList,(function(e){return i("a-select-option",{key:e.id},[t._v(" "+t._s(e.name)+" ")])})),1):t._e()],1)],1):i("div",[i("a-form-model",{attrs:{"label-col":{span:4},"wrapper-col":{span:18}}},[i("a-form-model-item",{attrs:{label:"小程序"}},[""==t.mediumTitle?i("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.importMedium("小程序")}}},[t._v("选择小程序")]):i("div",{staticClass:"import-box"},[i("a-icon",{attrs:{type:"check-circle",theme:"twoTone","two-tone-color":"#52c41a"}}),i("span",[t._v("已选择1条小程序")]),i("a-button",{attrs:{type:"link"},on:{click:function(){e.appletsModal=!1,e.importModal=!0}}},[t._v("[修改]")])],1)],1)],1)],1)],1),i("template",{slot:"footer"},[i("a-button",{on:{click:function(e){return t.reset("小程序")}}},[t._v("取消")]),i("a-button",{attrs:{type:"primary"},on:{click:t.appletsDefind}},[t._v("确定")])],1)],2)],1)},s=[],n=a("2909"),o=a("5530"),l=a("1da1"),r=(a("96cf"),a("d81d"),a("a15b"),a("99af"),a("ac1f"),a("1276"),a("a9e3"),a("b64b"),a("4de4"),a("d3b7"),a("b0c0"),a("a434"),a("5319"),a("fb6a"),a("a4d3"),a("e01a"),a("c1df")),c=a.n(r),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-upload",{class:e.btnType?"avatar-uploader":"btn-type",attrs:{name:"file","list-type":"picture-card",headers:e.headers,method:"post","show-upload-list":!1,action:e.uploadApi,"before-upload":e.beforeUpload},on:{change:e.handleChange}},[e.btnType?a("div",[e.imageUrl?a("div",{staticClass:"img-wrapper"},[a("img",{staticClass:"img",attrs:{src:e.imageUrl,alt:"avatar"}})]):a("div",[a("a-icon",{attrs:{type:e.loading?"loading":"plus"}})],1)]):a("a-button",{attrs:{type:"link"}},[e._v("重新上传")])],1)},d=[],u=(a("caad"),a("2532"),a("8ded")),p=a.n(u),h={props:{imageUrl:{type:String,default:""},fileType:{type:Number||Array,default:1},btnType:{type:Boolean,default:!0}},data:function(){return{loading:!1,FileTypeArr:["",["jpg","png","jpeg"],["mp3","amr"],["mp4"],["doc","docx","xls","xlsx","csv","ppt","pptx","txt","pdf","Xmind"]],uploadApi:Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_API_BASE_URL+"/dashboard/common/upload"}},computed:{headers:function(){var e=p.a.get("ACCESS_TOKEN");return{Accept:"application/json",Authorization:e}}},created:function(){},methods:{handleChange:function(e){if("uploading"!==e.file.status){if("done"===e.file.status){var t=e.file.response.data;this.$emit("success",t),this.loading=!1}if("error"===e.file.status&&e.file.response){var a=e.file.response;this.$message.error(a.msg)}}else this.loading=!0},beforeUpload:function(e){var t=this,a=this._getFileSuffix(e.name).toLowerCase(),i=e.type.split("/")[0],s=e.size/1024/1024<2,n=e.size/1024/1024<10,o=[];this.fileType instanceof Array?this.fileType.map((function(e){o.concat(t.FileTypeArr[e])})):o=this.FileTypeArr[this.fileType];var l=o.includes(a);return l?"video"===i?(n||this.$message.error("上传文件过大"),l&&n):(s||this.$message.error("上传文件过大"),l&&s):(this.$message.error("您只能上传以下类型： ".concat(o.join(","))),!1)},_getFileSuffix:function(e){return e.substring(e.lastIndexOf(".")+1)}}},g=h,f=(a("c8eb"),a("2877")),y=Object(f["a"])(g,m,d,!1,null,null,null),b=y.exports,v=a("c297"),x=a("6c6c"),T=a("d68b"),k=a("2ee5"),I=a("38b7"),M={components:{Department:v["a"],upload:b},data:function(){return{btnText:"展开",isEditEmp:!1,codeDetail:{},channelCodeId:"",imgModal:!1,localUploadModal:!1,btnLoading:!1,imageTextModal:!1,appletsModal:!1,importModal:!1,replaceFields:{title:"name",key:"id",children:"son",value:"id"},columns:[{align:"center",title:"名称",dataIndex:"employeeName"},{align:"center",title:"上限",dataIndex:"max",scopedSlots:{customRender:"max"}}],welcomeMessage:{scanCodePush:1,messageDetail:[]},currencyMessage:{type:1,welcomeContent:"",mediumId:""},cycleMessage:{type:2,status:2,detail:[{key:"周期欢迎语",chooseCycle:[],timeSlot:[{welcomeContent:"",mediumId:"",startTime:"",endTime:""}]}]},specialMessage:{type:3,status:2,detail:[{key:"特殊时期欢迎语",startDate:"",endDate:"",dataString:[],timeSlot:[{welcomeContent:"",mediumId:"",startTime:"",endTime:""}]}]},weekList:[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:0}],cycleTabIndex:1,specialTabIndex:1,baseInfo:{},tagModal:!1,tagGroupModal:!1,memberModal:!1,drainageEmployee:{type:1,employees:[],specialPeriod:{status:2},addMax:{status:2}},oneEmployeeValue:{key:"",label:""},checked1:1,weekTagList:[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}],cycleWeekTagList:[[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}]],checkedWeek:[],cycleCheckedWeek:[[]],tagGroupList:[],tagList:[],edit:!1,checkedTags:[],newGroupName:"",newTagsName:"",newTagsGroupId:"",channelCodeGroup:[],baseInfoRules:{groupId:[{required:!0,message:"请选择分组",trigger:"change"}],name:[{required:!0,message:"请输入活码名称",trigger:"blur"}],autoAddFriend:[{required:!0,message:"请选择是否自动添加好友",trigger:"change"}]},memberList:[],departmentList:[],employees:[],employeeIdList:"",choosePeopleShow:!1,selectDepartment:[],singleTimeList:[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],employeeSelect:{label:"",key:""}}],manyTimeList:[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],departmentSelect:[],employeeSelect:{label:"",key:""}}],manyTimeIndex:null,dataList:[],specialList:[],specialTimeList:[{dataString:[],startDate:"",endDate:"",timeSlot:[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],employeeSelect:{label:"",key:""}}]}],addSpecialList:[],specialIndex:null,specialPickerIndex:null,specialTimeSlotIndex:null,allMemderList:[],mediumType:"",mediumGroupId:"",materialData:[],mediumGroupList:[],searchStr:"",mediumDetail:{},mediumId:"",mediumTitle:"",upLoadRes:{},imgUrl:"",isSync:1,isImport:0,imageTextData:{},appletsData:{},isImageText:!1,isApplets:!1,imageForm:{title:[{required:!0,message:"请填写标题",trigger:"blur"}],imageLink:[{required:!0,message:"请输入跳转",trigger:"blur"}]},appletsForm:{appid:[{required:!0,message:"请输入小程序appID",trigger:"blur"}],page:[{required:!0,message:"请输入小程序路径",trigger:"blur"}],title:[{required:!0,message:"请输入卡片标题",trigger:"blur"}]},tabNum:"1",cycleMessageIndex:0,cycleTimeIndex:0,cycleMediumList:[{medium:[{title:"",imageFullPath:"",type:"",description:"",mediumTitle:""}]}],specialMessageIndex:0,specialTimeIndex:0,specialMediumList:[{medium:[{title:"",imageFullPath:"",type:"",description:"",mediumTitle:""}]}],editWeekList:[],isEdit:!1,startTime:null,endTime:null,spareEmployeeDis:!1,btnTextDis:!0}},created:function(){this.getChannelCodeGroup(),this.getTagGroups(),this.getDepartment(),this.channelCodeId=this.$route.query.channelCodeId,void 0!=this.channelCodeId&&(this.getChannelCodeDetail(),this.isEdit=!0)},watch:{specialTimeList:{handler:function(e){var t=this,a=e,i=!1;if(a.length>1){var s=this.isCrossData(a,a[a.length-1]);s&&(i=!0)}if(i)return this.$message.error("日期存在冲突");var n=!1;if(e.map((function(e){e.timeSlot.map((function(e){""===e.employeeId&&0==e.employeeId.length||(n=!0)}))})),n){var o=[],l={};this.specialTimeList.map((function(e){if(1==t.drainageEmployee.type)e.timeSlot.map((function(e){l={employeeName:void 0!=e.employeeSelect?e.employeeSelect.label:e.selectMembers.join(" "),employeeId:void 0!=e.employeeSelect?e.employeeSelect.key:e.employeeId.join(" "),max:""},o.push(l)}));else{var a=[];e.timeSlot.map((function(e){a=0!=e.employeeId.length?e.employeeId:[],a.length,a.map((function(t,a){l={employeeId:t,employeeName:e.selectMembers[a],max:""},o.push(l)}))}))}})),this.allMemderList=this.allMemderList.concat(o);for(var r=[],c={},m=0;m<this.allMemderList.length;m++)c[this.allMemderList[m].employeeId]||(r.push(this.allMemderList[m]),c[this.allMemderList[m].employeeId]=!0);this.allMemderList=r}},deep:!0}},methods:{moment:c.a,onChange:function(){this.$forceUpdate()},clickMore:function(){"展开"==this.btnText?this.btnText="收起":this.btnText="展开"},changeTime:function(e,t,a){"startTime"===a?this.startTime=t:this.endTime=t},getDisabledHours:function(){for(var e=[],t=this.startTime,a=t.split(":"),i=0;i<parseInt(a[0])+1;i++)e.push(i);return e},getDisabledSeconds:function(e,t){var a=this.startTime,i=a.split(":"),s=[];if(e==parseInt(i[0])+1&&t==parseInt(i[1]))for(var n=0;n<=parseInt(i[2]);n++)s.push(n);return s},getChannelCodeDetail:function(){var e=this;Object(k["c"])({channelCodeId:this.channelCodeId}).then((function(t){var a=t.data,i=a.baseInfo,s=a.drainageEmployee,n=a.welcomeMessage,o=[],l=[];e.baseInfo=i,e.drainageEmployee.type=s.type,e.tagList=i.tags,e.checkedTags=i.selectedTags||[],e.drainageEmployee.employees=s.employees||[],s.employees.map((function(t){1==e.drainageEmployee.type?(t.timeSlot.map((function(e){e.employeeId=Number(e.employeeId.join(" "))})),o.push(t.timeSlot)):l.push(t.timeSlot)})),e.singleTimeList=o,e.manyTimeList=l,e.drainageEmployee.addMax.status=s.addMax.status,e.allMemderList=s.addMax.employees||[],1==e.drainageEmployee.type?e.drainageEmployee.addMax.spareEmployeeIds=Number(s.addMax.spareEmployeeIds.join(" "))||"":e.drainageEmployee.addMax.spareEmployeeIds=s.addMax.spareEmployeeIds,e.drainageEmployee.specialPeriod.status=s.specialPeriod.status,e.specialTimeList=s.specialPeriod.detail||[],e.currencyMessage=n.messageDetail[0],e.cycleMessage=n.messageDetail[1],e.specialMessage=n.messageDetail[2],e.welcomeMessage.scanCodePush=n.scanCodePush,e.mediumDetail=n.messageDetail[0].content,3==Object.keys(n.messageDetail[0].content).length?(e.mediumDetail.type=2,e.mediumDetail.mediumTitle=n.messageDetail[0].content.imageName):void 0==n.messageDetail[0].content.appId?(e.mediumDetail.type=3,e.mediumDetail.mediumTitle=n.messageDetail[0].content.title):void 0!=n.messageDetail[0].content.appId&&(e.mediumDetail.type=6,e.mediumDetail.mediumTitle=n.messageDetail[0].content.title);var r={medium:[{title:"",imageFullPath:"",type:"",description:"",mediumTitle:""}]};e.cycleWeekTagList=[],0!==n.messageDetail[1].detail.length&&n.messageDetail[1].detail.map((function(t,a){var i=[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}];e.cycleMediumList.push(r),e.cycleWeekTagList.push(i),0!==e.cycleWeekTagList[a].length&&e.cycleWeekTagList[a].map((function(e){t.chooseCycle.map((function(t){e.id==t&&(e.isChecked=1)}))})),t.timeSlot.map((function(t,i){e.cycleMediumList[a].medium[i]=t.content,3==Object.keys(t.content).length?(e.cycleMediumList[a].medium[i].type=2,e.cycleMediumList[a].medium[i].mediumTitle=t.content.imageName):void 0==t.content.appId?(e.cycleMediumList[a].medium[i].type=3,e.cycleMediumList[a].medium[i].mediumTitle=t.content.title):(e.cycleMediumList[a].medium[i].type=6,e.cycleMediumList[a].medium[i].mediumTitle=t.content.title)}))})),0!==n.messageDetail[2].detail.length&&n.messageDetail[2].detail.map((function(t,a){e.specialMediumList.push(r),t.timeSlot.map((function(t,i){e.specialMediumList[a].medium[i]=t.content,3==Object.keys(t.content).length?e.specialMediumList[a].medium[i].type=2:void 0==t.content.appId?(e.specialMediumList[a].medium[i].type=3,e.specialMediumList[a].medium[i].mediumTitle=t.content.title):(e.specialMediumList[a].medium[i].type=6,e.specialMediumList[a].medium[i].mediumTitle=t.content.title)}))}))}))},getDepartment:function(){var e=this;Object(k["j"])().then((function(t){e.memberList=t.data.employee,e.departmentList=t.data.department}))},getChannelCodeGroup:function(){var e=this;Object(k["d"])().then((function(t){e.channelCodeGroup=t.data}))},getTagGroups:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(x["i"])();case 3:a=t.sent,i=a.data,e.tagGroupList=i,e.tagList=i.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{list:[]})})),e.tagList.length>5?(e.btnTextDis=!0,e.btnText="展开"):(e.btnTextDis=!1,e.btnText="收起"),t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](0);case 12:case"end":return t.stop()}}),t,null,[[0,10]])})))()},chooseTagGroup:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,s,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.edit){a.next=2;break}return a.abrupt("return");case 2:return i=t.tagList.filter((function(t){return t.groupId==e}))[0],s={groupId:e},a.prev=4,a.next=7,Object(T["b"])(s);case 7:n=a.sent,o=n.data,i.list=o.map((function(e){return{tagId:e.id,tagName:e.name,isSelected:2}})),a.next=14;break;case 12:a.prev=12,a.t0=a["catch"](4);case 14:case"end":return a.stop()}}),a,null,[[4,12]])})))()},chooseTag:function(e,t){var a=this.checkedTags.indexOf(t);a>-1?this.checkedTags.splice(a,1):this.checkedTags.push(t),e.list.filter((function(e){if(e.tagId==t)return e.isSelected=a>-1?2:1,!0}))},addNewTag:function(e){this.tagModal=!0,this.newTagsGroupId=e},addGroupTags:function(){var e=this;if(""!=this.newTagsName){var t=/\s+/g,a=this.newTagsName.replace(t," ").split(" "),i=!1;a.map((function(t){t.length>15&&(e.$message.error("每个标签最多15个字"),i=!0)})),i||(this.btnLoading=!0,Object(x["a"])({groupId:this.newTagsGroupId,tagName:a}).then((function(t){e.btnLoading=!1,e.newTagsName="",e.tagModal=!1,e.chooseTagGroup(e.newTagsGroupId)})))}else this.$message.error("请输入标签名称")},addGroup:function(){var e=this;""!=this.newGroupName?this.newGroupName.length>15?this.$message.error("分组名称不得超过15个字符"):(this.btnLoading=!0,Object(x["b"])({groupName:this.newGroupName}).then((function(t){e.btnLoading=!1,e.tagGroupModal=!1,e.newGroupName="",e.getTagGroups()}))):this.$message.error("请输入分组名称")},peopleChange:function(e){var t=[],a=[];e.map((function(e){t.push(e.employeeId),a.push(e.employeeName)})),this.employeeIdList=t.join(","),2==this.drainageEmployee.type&&null!=this.manyTimeIndex&&(this.manyTimeList[this.manyTimeIndex].employeeId=JSON.parse(JSON.stringify(t)),this.manyTimeList[this.manyTimeIndex].selectMembers=JSON.parse(JSON.stringify(a))),1==this.drainageEmployee.specialPeriod.status&&null!=this.specialPickerIndex&&(this.specialTimeList[this.specialPickerIndex].timeSlot[this.specialTimeSlotIndex].employeeId=JSON.parse(JSON.stringify(t)),this.specialTimeList[this.specialPickerIndex].timeSlot[this.specialTimeSlotIndex].selectMembers=JSON.parse(JSON.stringify(a))),1==this.drainageEmployee.addMax.status&&this.spareEmployeeDis&&(this.drainageEmployee.addMax.spareEmployeeIds=this.employeeIdList)},searchEmp:function(e){0===e.length?this.employeeIdList="空":this.employeeIdList=e[0].id},tabChange:function(e){this.tabNum=e,this.imageTextData={},this.appletsData={},this.imgUrl="",this.mediumId=""},onEdit:function(e,t){this[t](e)},add:function(){this.imgUrl="",this.mediumId="",this.cycleTabIndex++;var e="周期欢迎语".concat(this.cycleTabIndex),t={key:e,chooseCycle:[],timeSlot:[]},a={medium:[{title:"",imageFullPath:"",type:"",description:"",mediumTitle:""}]},i=[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}];this.cycleWeekTagList.push(i),this.cycleMediumList.push(a),this.cycleMessage.detail.push(t),this.cycleCheckedWeek.push([]),this.imageTextData={},this.appletsData={}},remove:function(e){this.imgUrl="",this.mediumId="",this.cycleTabIndex--,this.cycleMediumList.slice(this.cycleTabIndex,0);var t=this.cycleMessage.detail.filter((function(t){return t.key!==e}));t.map((function(e,t){0!==t&&(e.chooseCycle=[],e.timeSlot=[],e.key="周期欢迎语"+(t+1))})),this.cycleMessage.detail=t},onEdits:function(e,t){this[t+"s"](e)},adds:function(){this.imgUrl="",this.mediumId="",this.specialTabIndex++;var e="特殊时期欢迎语".concat(this.specialTabIndex),t={key:e,startDate:"",endDate:"",timeSlot:[]},a={medium:[{title:"",imageFullPath:"",type:"",description:"",mediumTitle:""}]};this.specialMediumList.push(a),this.specialMessage.detail.push(t),this.specialCheckedWeek=[],this.imageTextData={},this.appletsData={}},removes:function(e){this.imgUrl="",this.mediumId="",this.specialTabIndex--,this.specialMediumList.slice(this.specialTabIndex,0);var t=this.specialMessage.detail.filter((function(t){return t.key!==e}));t.map((function(e,t){0!==t&&(e.startDate="",e.endDate="",e.timeSlot=[],e.key="特殊时期欢迎语"+(t+1))})),this.cycleMessage.detail=t},addCycleTime:function(e){this.imgUrl="",this.mediumId="",this.imageTextData={},this.appletsData={};var t={welcomeContent:"",mediumId:"",startTime:"",endTime:""},a={title:"",imageFullPath:"",type:"",description:"",mediumTitle:""};this.cycleMessage.detail[e].timeSlot.push(t),this.cycleMediumList[e].medium.push(a)},addSpecialMessageTime:function(e){this.imgUrl="",this.mediumId="",this.imageTextData={},this.appletsData={};var t={welcomeContent:"",mediumId:"",startTime:"",endTime:""},a={title:"",imageFullPath:"",type:"",description:"",mediumTitle:""};this.specialMessage.detail[e].timeSlot.push(t),this.specialMediumList[e].medium.push(a)},defineDateIndex:function(e){this.specialMessageIndex=e},specialDate:function(e,t){this.specialMessage.detail[this.specialMessageIndex].startDate=t[0],this.specialMessage.detail[this.specialMessageIndex].endDate=t[1]},imgBoxModal:function(e){"图片"==e?(this.imgModal=!0,this.mediumType=2):"图文"==e?(this.imageTextModal=!0,this.mediumType=3):"小程序"==e&&(this.appletsModal=!0,this.mediumType=6),this.getMaterialLibrary()},cycleImgBoxModal:function(e,t,a){this.cycleMessageIndex=t,this.cycleTimeIndex=a,"图片"==e?(this.imgModal=!0,this.mediumType=2):"图文"==e?(this.imageTextModal=!0,this.mediumType=3):"小程序"==e&&(this.appletsModal=!0,this.mediumType=6),this.imgUrl="",this.getMaterialLibrary()},specialImgBoxModal:function(e,t,a){this.specialMessageIndex=t,this.specialTimeIndex=a,"图片"==e?(this.imgModal=!0,this.mediumType=2):"图文"==e?(this.imageTextModal=!0,this.mediumType=3):"小程序"==e&&(this.appletsModal=!0,this.mediumType=6),this.getMaterialLibrary()},insert:function(e,t,a){if("通用"==e){var i=document.getElementById("currency"),s=i.selectionStart;this.currencyMessage.welcomeContent=this.currencyMessage.welcomeContent.slice(0,s)+"##客户名称##"+this.currencyMessage.welcomeContent.slice(s)}else if("周期"==e){var n=document.getElementById("cycle"),o=n.selectionStart;this.cycleMessage.detail[a].timeSlot[t].welcomeContent=this.cycleMessage.detail[a].timeSlot[t].welcomeContent.slice(0,o)+"##客户名称##"+this.cycleMessage.detail[a].timeSlot[t].welcomeContent.slice(o)}else if("特殊"==e){var l=document.getElementById("special"),r=l.selectionStart;this.specialMessage.detail[a].timeSlot[t].welcomeContent=this.specialMessage.detail[a].timeSlot[t].welcomeContent.slice(0,r)+"##客户名称##"+this.specialMessage.detail[a].timeSlot[t].welcomeContent.slice(r)}},getMaterialLibrary:function(){var e=this;Object(I["h"])({mediumGroupId:this.mediumGroupId,searchStr:this.searchStr,type:this.mediumType}).then((function(t){e.materialData=t.data.list})),this.getMediumGroup()},getMediumGroup:function(){var e=this;Object(I["i"])().then((function(t){e.mediumGroupList=t.data,e.mediumGroupId=0})).catch((function(t){e.mediumGroupId=""}))},definedMedium:function(e,t){this.imgModal=!1,this.isImageText?(this.upLoadRes=t,this.imgUrl=t.imageFullPath,this.imageTextModal=!0,this.isImageText=!1,this.mediumType=3):this.isApplets?(this.upLoadRes=t,this.imgUrl=t.imageFullPath,this.appletsModal=!0,this.isApplets=!1,this.mediumType=6):(this.mediumId=e,this.upLoadRes=t,this.mediumTitle=t.imageName,this.mediumDetail=t,this.mediumDetail.mediumTitle=t.imageName,this.mediumDetail.type=2,this.mediumType=2,1==this.tabNum?this.currencyMessage.mediumId=this.mediumId:2==this.tabNum?(this.cycleMessage.detail[this.cycleMessageIndex].timeSlot[this.cycleTimeIndex].mediumId=this.mediumId,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex]=this.mediumDetail,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].type=2,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].mediumTitle=this.mediumTitle):3==this.tabNum&&(this.specialMessage.detail[this.specialMessageIndex].timeSlot[this.specialTimeIndex].mediumId=this.mediumId,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex]=this.mediumDetail,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].type=2,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].mediumTitle=this.mediumTitle))},changeGroup:function(e){this.mediumGroupId=e,this.getMaterialLibrary()},showMedium:function(){2==this.mediumType?(this.visible=!0,this.getMaterialLibrary()):3==this.mediumType?this.imageTextModal=!0:this.appletsModal=!0},closeMedium:function(){this.mediumDetail={},this.mediumTitle="",this.mediumId="",this.upLoadRes={},this.imgUrl=""},cycleCloseMedium:function(e,t){this.mediumId="",this.upLoadRes={},this.imgUrl="",this.cycleMediumList[e].medium[t]={},this.cycleMediumList=Object(n["a"])(this.cycleMediumList)},specialCloseMedium:function(e,t){this.mediumId="",this.upLoadRes={},this.imgUrl="",this.specialMediumList[e].medium[t]={},this.specialMediumList=Object(n["a"])(this.specialMediumList)},uploadSuccess:function(e){this.imgUrl=e.fullPath;var t=e.path;this.upLoadRes.imageFullPath=e.fullPath,this.upLoadRes.imagePath=t,this.upLoadRes.imageName=e.name},uploadImage:function(){var e=this;""!=this.imgUrl?Object(I["a"])({type:2,isSync:this.isSync,content:this.upLoadRes,mediumGroupId:this.mediumGroupId}).then((function(t){e.localUploadModal=!1,e.imgModal=!1,e.isImageText?(e.isImageText=!1,e.imageTextModal=!0,e.mediumType=3):e.isApplets?(e.isApplets=!1,e.appletsModal=!0,e.mediumType=6):(e.mediumDetail.type=2,e.mediumDetail=e.upLoadRes,e.mediumDetail.mediumTitle=e.upLoadRes.imageName,e.mediumDetail.imageFullPath=e.upLoadRes.imageFullPath,e.mediumId=t.data.id,1==e.tabNum?e.currencyMessage.mediumId=e.mediumId:2==e.tabNum?(e.cycleMessage.detail[e.cycleMessageIndex].timeSlot[e.cycleTimeIndex].mediumId=e.mediumId,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex]=e.mediumDetail,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].type=2,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].imageFullPath=e.upLoadRes.imageFullPath,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].mediumTitle=e.mediumTitle):3==e.tabNum&&(e.specialMessage.detail[e.specialMessageIndex].timeSlot[e.specialTimeIndex].mediumId=e.mediumId,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex]=e.mediumDetail,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].type=2,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].mediumTitle=e.mediumTitle))})):this.$message.error("请上传")},uploadModal:function(){this.localUploadModal=!0},mediumModal:function(e){this.imgModal=!0,3==this.mediumType||"isImage"==e?(this.imageTextModal=!1,this.isImageText=!0,this.mediumType=2):6!=this.mediumType&&"isApplets"!=e||(this.appletsModal=!1,this.isApplets=!0,this.mediumType=2),this.getMaterialLibrary()},importMedium:function(e){this.importModal=!0,"图文"==e?(this.mediumType=3,this.imageTextModal=!1):(this.mediumType=6,this.appletsModal=!1),this.getMaterialLibrary()},importDefined:function(){""!=this.mediumId?(this.importModal=!1,3==this.mediumType?(this.imageTextModal=!1,this.mediumDetail.type=3,2==this.tabNum?(this.cycleMessage.detail[this.cycleMessageIndex].timeSlot[this.cycleTimeIndex].mediumId=this.mediumId,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex]=this.mediumDetail,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].type=3,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].imageFullPath=this.upLoadRes.imageFullPath,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].mediumTitle=this.mediumTitle):3==this.tabNum&&(this.specialMessage.detail[this.specialMessageIndex].timeSlot[this.specialTimeIndex].mediumId=this.mediumId,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex]=this.mediumDetail,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].type=3,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].mediumTitle=this.mediumTitle)):(this.appletsModal=!1,this.mediumDetail.type=6,2==this.tabNum?(this.cycleMessage.detail[this.cycleMessageIndex].timeSlot[this.cycleTimeIndex].mediumId=this.mediumId,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex]=this.mediumDetail,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].type=6,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].imageFullPath=this.upLoadRes.imageFullPath,this.cycleMediumList[this.cycleMessageIndex].medium[this.cycleTimeIndex].mediumTitle=this.mediumTitle):3==this.tabNum&&(this.specialMessage.detail[this.specialMessageIndex].timeSlot[this.specialTimeIndex].mediumId=this.mediumId,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex]=this.mediumDetail,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].type=6,this.specialMediumList[this.specialMessageIndex].medium[this.specialTimeIndex].mediumTitle=this.mediumTitle))):this.$message.error("请选择素材")},resetImage:function(){this.imgModal=!1,this.mediumDetail={},this.mediumTitle="",this.mediumId="",this.searchStr="",this.isImageText?this.imageTextModal=!0:this.isApplets?this.appletsModal=!0:this.imgModal=!1},resetImport:function(){this.importModal=!1,this.mediumDetail={},this.mediumTitle="",this.mediumId="",this.searchStr="",3==this.mediumType?this.imageTextModal=!0:this.appletsModal=!0},reset:function(e){this.imgUrl="",this.isImport=0,this.isSync=1,"图片"===e?(this.imageTextModal=!1,this.imageTextData={},this.upLoadRes={},this.isImageText=!1):(this.appletsData={},this.appletsModal=!1,this.upLoadRes={},this.isApplets=!1)},importChange:function(){this.imageTextData={},this.appletsData={},this.imgUrl="",this.upLoadRes={},this.mediumDetail={},this.mediumTitle=""},addImageTextDefine:function(){var e=this;if(1==this.isImport){if(""==this.mediumId)return void this.$message.error("请选择素材");this.appletsModal=!1,this.isImport=0,this.mediumDetail.type=3}else{var t=/(http|https):\/\/([\w.]+\/?)\S*/;if(!t.test(this.imageTextData.imageLink))return void this.$message.error("点击跳转以http://或http://开头");this.$refs.imageForm.validate((function(t){if(!t)return!1;var a={title:e.imageTextData.title,description:e.imageTextData.description,imagePath:e.upLoadRes.imagePath,imageLink:e.imageTextData.imageLink,imageName:e.upLoadRes.imageName};void 0!=e.upLoadRes.imagePath?Object(I["a"])({type:e.mediumType,mediumGroupId:e.mediumGroupId,content:a,isSync:e.isSync}).then((function(t){e.mediumType=3,e.mediumId=t.data.id,e.mediumDetail=a,e.mediumDetail.imageFullPath=e.upLoadRes.imageFullPath,e.mediumDetail.type=3,e.mediumDetail.mediumTitle=a.title,e.imageTextModal=!1,1==e.tabNum?e.currencyMessage.mediumId=e.mediumId:2==e.tabNum?(e.cycleMessage.detail[e.cycleMessageIndex].timeSlot[e.cycleTimeIndex].mediumId=e.mediumId,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex]=e.mediumDetail,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].type=3,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].imageFullPath=e.upLoadRes.imageFullPath,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].mediumTitle=e.mediumTitle):3==e.tabNum&&(e.specialMessage.detail[e.specialMessageIndex].timeSlot[e.specialTimeIndex].mediumId=e.mediumId,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex]=e.mediumDetail,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].type=3,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].mediumTitle=e.mediumTitle)})):e.$message.error("请上传图片")}))}},appletsDefind:function(){var e=this;if(1==this.isImport){if(""==this.mediumId)return void this.$message.error("请选择素材");this.appletsModal=!1,this.isImport=0,this.mediumDetail.type=6}else this.$refs.appletsForm.validate((function(t){if(!t)return!1;var a={title:e.appletsData.title,page:e.appletsData.page,imagePath:e.upLoadRes.imagePath,appid:e.appletsData.appid,imageName:e.upLoadRes.imageName};void 0!=e.upLoadRes.imagePath?Object(I["a"])({type:e.mediumType,mediumGroupId:e.mediumGroupId,content:a,isSync:e.isSync}).then((function(t){e.mediumType=6,e.mediumId=t.data.id,e.mediumDetail=a,e.mediumDetail.imageFullPath=e.upLoadRes.imageFullPath,e.mediumDetail.type=6,e.mediumDetail.mediumTitle=a.title,e.appletsModal=!1,1==e.tabNum?e.currencyMessage.mediumId=e.mediumId:2==e.tabNum?(e.cycleMessage.detail[e.cycleMessageIndex].timeSlot[e.cycleTimeIndex].mediumId=e.mediumId,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex]=e.mediumDetail,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].type=6,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].imageFullPath=e.upLoadRes.imageFullPath,e.cycleMediumList[e.cycleMessageIndex].medium[e.cycleTimeIndex].mediumTitle=e.mediumTitle):3==e.tabNum&&(e.specialMessage.detail[e.specialMessageIndex].timeSlot[e.specialTimeIndex].mediumId=e.mediumId,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex]=e.mediumDetail,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].type=6,e.specialMediumList[e.specialMessageIndex].medium[e.specialTimeIndex].mediumTitle=e.mediumTitle)})):e.$message.error("请上传图片")}))},cycleWeek:function(e,t){var a=this.cycleMessage.detail[t].chooseCycle.indexOf(e);a>-1?this.cycleMessage.detail[t].chooseCycle.splice(a,1):this.cycleMessage.detail[t].chooseCycle.push(e),this.cycleWeekTagList[t].filter((function(t){if(t.id==e)return t.isChecked=a>-1?2:1,!0}))},mediumImport:function(e,t){this.mediumId=e,this.mediumTitle=t.title,this.mediumDetail=t,this.mediumDetail.imageFullPath=t.imageFullPath},cycleDelete:function(e,t){this.cycleMessage.detail[e].timeSlot.splice(t,1)},specialDelete:function(e,t){this.specialMessage.detail[e].timeSlot.splice(t,1)},recordIndex:function(e,t){this.manyTimeIndex=e,this.specialIndex=e,this.specialPickerIndex=e,"人员"==t?this.choosePeopleShow=!0:"备用人员"==t&&(this.choosePeopleShow=!0,this.spareEmployeeDis=!0,this.manyTimeIndex=null,this.specialPickerIndex=null),this.employeeIdList="",this.employees=[]},typeChange:function(e){this.drainageEmployee.employees=[],this.singleTimeList=[{employeeId:[],departmentId:[],startTime:"00:00",endTime:"00:00",employeeSelect:{label:"",key:""},selectMembers:""}],this.manyTimeList=[{employeeId:[],departmentId:[],startTime:"00:00",endTime:"00:00",departmentSelect:[],employeeSelect:{label:"",key:""},selectMembers:""}]},chooseWeekTag:function(e){var t=this.checkedWeek.indexOf(e);t>-1?this.checkedWeek.splice(t,1):this.checkedWeek.push(e),this.weekTagList.filter((function(a){if(a.id==e)return a.isChecked=t>-1?2:1,!0}))},addSingleTime:function(){var e={employeeId:[],departmentId:[],startTime:"",endTime:"",employeeSelect:{label:"",key:""},selectMembers:""};this.singleTimeList.push(e)},addManyTime:function(){var e={employeeId:[],departmentId:[],startTime:"",endTime:"",selectDepartment:[],departmentSelect:[],selectMembers:[]};this.manyTimeList.push(e)},deleteSingle:function(e,t){"单人"==t?this.singleTimeList.splice(e,1):this.manyTimeList.splice(e,1)},editEmployess:function(e,t,a){this.isEditEmp=!0;var i=e.week;this.checkedWeek.push(i),this.weekTagList.map((function(e){e.id==i&&(e.isChecked=1)})),this.memberModal=!0,1==this.drainageEmployee.type?this.singleTimeList=JSON.parse(JSON.stringify(e.timeSlot)):this.manyTimeList=JSON.parse(JSON.stringify(e.timeSlot))},drainageDefine:function(){var e=this,t=!1,a=!1;if(1==this.drainageEmployee.type){var i=this.singleTimeList,s=!1;if(i.length>1){var n=this.isCrossTime(i,i[i.length-1]);n&&(s=!0)}if(s)return this.$message.error("时间段存在冲突");if(this.isEditEmp)if(this.singleTimeList.map((function(e){e.employeeId=e.employeeSelect.key,e.selectMembers=e.employeeSelect.label})),7==this.checkedWeek.length){var o={};this.checkedWeek.map((function(t){o={week:t,timeSlot:JSON.parse(JSON.stringify(e.singleTimeList))},e.dataList.push(o)})),this.drainageEmployee.employees=this.dataList}else this.drainageEmployee.employees.map((function(t){e.checkedWeek.map((function(a){t.week==a&&(t.timeSlot=JSON.parse(JSON.stringify(e.singleTimeList)))}))}));else{if(this.singleTimeList.map((function(e){e.employeeId=e.employeeSelect.key,e.selectMembers=e.employeeSelect.label,""==e.employeeId&&(t=!0)})),t)return void this.$message.error("请选择成员");if(0==this.checkedWeek.length)return void this.$message.error("请选择适用周期");var l={};if(this.checkedWeek.map((function(t){l={week:t,timeSlot:e.singleTimeList},e.dataList.push(l)})),0!==this.drainageEmployee.employees.length){var r=[];this.dataList.map((function(t){var a=!1;e.drainageEmployee.employees.map((function(e){t.week==e.week&&(a=!0,e.timeSlot=t.timeSlot)})),a||r.push(t)})),this.drainageEmployee.employees=this.drainageEmployee.employees.concat(r)}else this.drainageEmployee.employees=this.dataList}}else{var c=this.manyTimeList,m=!1;if(c.length>1){var d=this.isCrossTime(c,c[c.length-1]);d&&(m=!0)}if(m)return this.$message.error("时间段存在冲突");if(this.isEditEmp)if(this.manyTimeList.map((function(e){var t=[],a=[];e.departmentSelect.map((function(e){t.push(e.value),a.push(e.label)})),e.departmentId=t,e.selectDepartment=a})),7==this.checkedWeek.length){var u={};this.checkedWeek.map((function(t){u={week:t,timeSlot:JSON.parse(JSON.stringify(e.manyTimeList))},e.dataList.push(u)})),this.drainageEmployee.employees=this.dataList}else this.drainageEmployee.employees.map((function(t){e.checkedWeek.map((function(a){t.week==a&&(t.timeSlot=JSON.parse(JSON.stringify(e.manyTimeList)))}))}));else{if(this.manyTimeList.map((function(e){var t=[],i=[];e.departmentSelect.map((function(e){t.push(e.value),i.push(e.label)})),e.departmentId=t,e.selectDepartment=i,0==e.employeeId.length&&0==e.departmentId.length&&(a=!0)})),a)return void this.$message.error("请选择成员或企业部门");if(0==this.checkedWeek.length)return void this.$message.error("请选择适用周期");var p={};if(this.checkedWeek.map((function(t){p={week:t,timeSlot:e.manyTimeList},e.dataList.push(p)})),0!==this.drainageEmployee.employees.length){var h=[];this.dataList.map((function(t){var a=!1;e.drainageEmployee.employees.map((function(e){t.week==e.week&&(a=!0,e.timeSlot=t.timeSlot)})),a||h.push(t)})),this.drainageEmployee.employees=this.drainageEmployee.employees.concat(h)}else this.drainageEmployee.employees=this.dataList}}this.memberModal=!1,this.dataList=[],this.manyTimeIndex=null,this.singleTimeList=[{employeeId:[],departmentId:[],startTime:"00:00",endTime:"00:00",employeeSelect:{label:"",key:""},selectMembers:""}],this.manyTimeList=[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],departmentSelect:[],employeeSelect:{label:"",key:""}}],this.weekTagList=[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}],this.checkedWeek=[];var g=[],f={};this.drainageEmployee.employees.map((function(t){1==e.drainageEmployee.type?t.timeSlot.map((function(e){e.employeeId=e.employeeSelect.key,e.selectMembers=e.employeeSelect.label,f={employeeName:e.selectMembers,employeeId:e.employeeId,max:""},g.push(f)})):t.timeSlot.map((function(e){e.employeeId.map((function(t,a){f={employeeId:t,employeeName:e.selectMembers[a],max:""},g.push(f)}))}))})),this.allMemderList=this.allMemderList.concat(g);for(var y=[],b={},v=0;v<this.allMemderList.length;v++)b[this.allMemderList[v].employeeId]||(y.push(this.allMemderList[v]),b[this.allMemderList[v].employeeId]=!0);this.allMemderList=y},isCrossTime:function(e,t){function a(e){return Number(e.split(":").join(""))}var i=a(t.startTime),s=a(t.endTime);if(e.length>2)for(var n=1;n<e.length;n++){var o=e[n],l=a(o.startTime),r=a(o.endTime);return i<r||s<l}},isCrossData:function(e,t){function a(e){var t=e.replace(/-/g,"/");return new Date(Date.parse(t)).getTime()}for(var i=a(t.startDate),s=a(t.endDate),n=0;n<e.length+1;n++){var o=e[n],l=a(o.startDate),r=a(o.endDate);return!isNaN(i)&&!isNaN(s)&&!(i>r||s<l)}},resetDrainage:function(){this.memberModal=!1,this.singleTimeList=[{employeeId:[],departmentId:[],startTime:"00:00",endTime:"00:00",employeeSelect:{label:"",key:""},selectMembers:""}],this.manyTimeList=[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],departmentSelect:[],employeeSelect:{label:"",key:""}}],this.weekTagList=[{name:"周一",id:1,isChecked:2},{name:"周二",id:2,isChecked:2},{name:"周三",id:3,isChecked:2},{name:"周四",id:4,isChecked:2},{name:"周五",id:5,isChecked:2},{name:"周六",id:6,isChecked:2},{name:"周日",id:0,isChecked:2}],this.checkedWeek=[]},onSpecialChange:function(e){this.drainageEmployee.specialPeriod.status=e?1:2},inputNum:function(e){var t=/^(0|[1-9][0-9]*)$/;t.test(e)||this.$message.error("请输入正确数字")},onAddMaxChange:function(){},deleteSpecialTime:function(e,t){this.specialTimeList[e].timeSlot.splice(t,1)},deleteSpecial:function(e){this.specialTimeList.splice(e,1)},addSpecialTime:function(e){var t={startTime:"",endTime:"",employeeId:"",selectMembers:[],departmentId:[],employeeSelect:{label:"",key:""}};this.specialTimeList[e].timeSlot.push(t)},clickPicker:function(e){this.specialPickerIndex=e},changeData:function(e,t){this.specialTimeList[this.specialPickerIndex].startDate=t[0],this.specialTimeList[this.specialPickerIndex].endDate=t[1]},specialMember:function(e,t){this.choosePeopleShow=!0,this.specialPickerIndex=e,this.specialTimeSlotIndex=t,this.employeeIdList="",this.employees=[]},addPeriod:function(){var e={startDate:"",endDate:"",timeSlot:[{startTime:"00:00",endTime:"00:00",employeeId:"",selectMembers:[],departmentId:[],employeeSelect:{label:"",key:""}}]};this.specialTimeList.push(e)},isCrossMessageTime:function(e,t){function a(e){return Number(e.split(":").join(""))}for(var i=a(t.startTime),s=a(t.endTime),n=0;n<e.length;n++){var o=e[n],l=a(o.startTime),r=a(o.endTime);return!(i>r||s<l)}},defineChannelCode:function(){var e=this,t=[];this.specialTimeList=this.specialTimeList.map((function(a){return 1==e.drainageEmployee.type?a.timeSlot=a.timeSlot.map((function(e){return e.employeeId=void 0==e.employeeSelect?e.employeeId:[e.employeeSelect.key+""],e.selectMembers=void 0==e.employeeSelect?e.selectMembers:e.employeeSelect.label,e})):a.timeSlot.map((function(e){e.departmentId.map((function(e){t.push(e.value)})),e.departmentId=t})),a}));var a={status:this.drainageEmployee.specialPeriod.status,detail:this.specialTimeList},i={status:this.drainageEmployee.addMax.status,employees:this.allMemderList,spareEmployeeIds:(this.drainageEmployee.addMax.spareEmployeeIds+"").split(",").map(Number)};if(this.drainageEmployee.employees.map((function(t){1==e.drainageEmployee.type&&t.timeSlot.map((function(e){e.employeeId=(e.employeeId+"").split(",").map(Number)}))})),this.drainageEmployee.employees.length<7)this.$message.error("周成员缺失！");else{var s={type:this.drainageEmployee.type,employees:this.drainageEmployee.employees,specialPeriod:a,addMax:i};this.currencyMessage.mediumId=this.currencyMessage.mediumId+"",this.cycleMessage.detail.map((function(e){e.timeSlot.map((function(e){e.mediumId=e.mediumId+""}))})),this.specialMessage.detail.map((function(e){e.timeSlot.map((function(e){e.mediumId=e.mediumId+""}))}));var n=!1;if(1==this.welcomeMessage.scanCodePush){if(""==this.currencyMessage.welcomeContent||""==this.cycleMessage.mediumId)return void this.$message.error("通用欢迎语内容不能为空");1==this.cycleMessage.status&&this.cycleMessage.detail.map((function(t,a){0==t.chooseCycle.length&&(e.$message.error("请填写周期欢迎语".concat(a+1,"的周期！")),n=!0);var i=t.timeSlot,s=!1;if(i.length>1){var o=e.isCrossMessageTime(i,i[i.length-1]);o&&(s=!0,n=!0)}s&&e.$message.error("周期欢迎语时间段存在冲突"),t.timeSlot.map((function(t,i){""!=t.startTime&&""!=t.endTime||(e.$message.error("请填写周期欢迎语".concat(a+1,"的时间段").concat(i+1,"！")),n=!0)}))})),1==this.specialMessage.status&&this.specialMessage.detail.map((function(t,a){""!=t.startDate&&""!=t.endDate||(e.$message.error("请填写特殊时期欢迎语".concat(a+1,"的日期！")),n=!0);var i=t.timeSlot,s=!1;if(i.length>1){var o=e.isCrossMessageTime(i,i[i.length-1]);o&&(s=!0,n=!0)}s&&e.$message.error("特殊时期欢迎语时间段存在冲突"),t.timeSlot.map((function(t,i){""!=t.startTime&&""!=t.endTime||(e.$message.error("请填写特殊时期欢迎语".concat(a+1,"的时间段").concat(i+1,"！")),n=!0)}))}))}if(!n){var o=[];o[0]=this.currencyMessage,o[1]=this.cycleMessage,o[2]=this.specialMessage;var l={scanCodePush:this.welcomeMessage.scanCodePush,messageDetail:o};this.$refs.baseInfoRules.validate((function(t){if(!t)return!1;var a={groupId:e.baseInfo.groupId,name:e.baseInfo.name,autoAddFriend:e.baseInfo.autoAddFriend,tags:e.checkedTags};e.btnLoading=!0,e.isEdit?Object(k["i"])({channelCodeId:e.channelCodeId,baseInfo:a,drainageEmployee:s,welcomeMessage:l}).then((function(t){e.btnLoading=!1,e.$message.success("修改成功"),e.$router.push("/channelCode/index")})).catch((function(t){e.btnLoading=!1})):Object(k["a"])({baseInfo:a,drainageEmployee:s,welcomeMessage:l}).then((function(t){e.btnLoading=!1,e.$message.success("创建成功"),e.$router.push("/channelCode/index")})).catch((function(t){e.btnLoading=!1}))}))}}}}},C=M,_=(a("cd95"),Object(f["a"])(C,i,s,!1,null,"366cd83f",null));t["default"]=_.exports},d68b:function(e,t,a){"use strict";a.d(t,"f",(function(){return s})),a.d(t,"d",(function(){return n})),a.d(t,"g",(function(){return o})),a.d(t,"e",(function(){return l})),a.d(t,"k",(function(){return r})),a.d(t,"b",(function(){return c})),a.d(t,"h",(function(){return m})),a.d(t,"c",(function(){return d})),a.d(t,"a",(function(){return u})),a.d(t,"i",(function(){return p})),a.d(t,"j",(function(){return h}));var i=a("b775");function s(e){return Object(i["b"])({url:"/contactFieldPivot/index",method:"get",params:e})}function n(e){return Object(i["b"])({url:"/contactFieldPivot/update",method:"put",data:e})}function o(e){return Object(i["b"])({url:"/workContact/show",method:"get",params:e})}function l(e){return Object(i["b"])({url:"/workContact/update",method:"put",data:e})}function r(e){return Object(i["b"])({url:"/workContact/index",method:"get",params:e})}function c(e){return Object(i["b"])({url:"/workContactTag/allTag",method:"get",params:e})}function m(e){return Object(i["b"])({url:"/workRoom/roomIndex",method:"get",params:e})}function d(e){return Object(i["b"])({url:"/workContact/source",method:"get",params:e})}function u(e){return Object(i["b"])({url:"/contactField/portrait",method:"get",params:e})}function p(e){return Object(i["b"])({url:"/workContact/synContact",method:"put",data:e})}function h(e){return Object(i["b"])({url:"/workContact/track",method:"get",params:e})}},f231:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"group-statistics"},[a("a-card",[a("div",{staticClass:"number-box"},[a("div",{staticClass:"number one"},[a("p",[e._v("今日新增客户数")]),a("h1",[e._v(e._s(e.addNum))])]),a("div",{staticClass:"number two"},[a("p",[e._v("今日被客户删除/拉黑的人数")]),a("h1",[e._v(e._s(e.defriendNum))])]),a("div",{staticClass:"number thr"},[a("p",[e._v("今日删除人数")]),a("h1",[e._v(e._s(e.deleteNum))])]),a("div",{staticClass:"number four"},[a("p",[e._v("今日净增人数")]),a("h1",[e._v(e._s(e.netNum))])])]),a("div",{staticClass:"type-wrapper"},[a("a-button",{staticClass:"type",attrs:{type:1==e.type?"primary":""},on:{click:function(t){return e.changeType(1)}}},[e._v("按日")]),a("a-range-picker",{staticClass:"type",on:{change:e.dateChange},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),a("a-button",{staticClass:"type",attrs:{type:2==e.type?"primary":""},on:{click:function(t){return e.changeType(2)}}},[e._v("按周")]),a("a-button",{attrs:{type:3==e.type?"primary":""},on:{click:function(t){return e.changeType(3)}}},[e._v("按月")])],1),a("div",[e._v(" 这段时间里，共新增客户数 "+e._s(e.addNumLong)+" 人，被客户删除/拉黑 "+e._s(e.defriendNumLong)+" 人，员工删除客户"+e._s(e.deleteNumLong)+"人，净增人数"+e._s(e.netNumLong)+"人 ")]),e.statisticsShow?a("div",{staticClass:"chart-wrapper"},[a("v-chart",{attrs:{options:e.options}})],1):e._e(),a("div",{staticClass:"table-title"},[e._v(" 详细数据 ")]),a("a-table",{attrs:{bordered:"",rowKey:"time",pagination:e.pagination,columns:e.columns,"data-source":e.tableData},on:{change:e.handleTableChange}})],1)],1)},s=[],n=(a("d3b7"),a("159b"),a("d81d"),a("b0c0"),a("c1df")),o=a.n(n),l=a("2ee5"),r={data:function(){return{statisticsShow:!0,channelCodeId:"",type:2,time:null,startTime:"",endTime:"",columns:[{align:"center",title:"时间",dataIndex:"time"},{align:"center",title:"新增客户数",dataIndex:"addNumRange"},{align:"center",title:"被客户删除/拉黑人数",dataIndex:"defriendNumRange"},{align:"center",title:"删除人数",dataIndex:"deleteNumRange"},{title:"净增客户数",align:"center",dataIndex:"netNumRange"}],tableData:[],pagination:{total:0,current:1,pageSize:10,showSizeChanger:!0},addNum:0,defriendNum:0,deleteNum:0,netNum:0,addNumLong:0,defriendNumLong:0,deleteNumLong:0,netNumLong:0,options:{tooltip:{trigger:"axis"},legend:{data:["新增客户数","被客户删除/拉黑人数","删除人数","净增人数"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{name:"新增客户数",type:"line",data:[],itemStyle:{normal:{color:"#1890ff",lineStyle:{color:"#1890ff"}}}},{name:"删除人数",type:"line",data:[],itemStyle:{normal:{color:"violet",lineStyle:{color:"violet"}}}},{name:"净增人数",type:"line",data:[],itemStyle:{normal:{color:"pink",lineStyle:{color:"pink"}}}},{name:"被客户删除/拉黑人数",type:"line",data:[],itemStyle:{normal:{color:"yellow",lineStyle:{color:"yellow"}}}}]}}},created:function(){this.channelCodeId=this.$route.query.channelCodeId,this.getStatisticsIndex(),this.getStatistics()},methods:{getStatisticsIndex:function(){var e=this,t={channelCodeId:this.channelCodeId,type:this.type,startTime:this.startTime,endTime:this.endTime,page:this.pagination.current,perPage:this.pagination.pageSize};Object(l["l"])(t).then((function(t){e.tableData=t.data.list,e.pagination.total=t.data.page.total}))},getStatistics:function(){var e=this,t={channelCodeId:this.channelCodeId,type:this.type,startTime:this.startTime,endTime:this.endTime};Object(l["k"])(t).then((function(t){var a=t.data,i=a.addNum,s=a.addNumLong,n=a.defriendNum,o=a.defriendNumLong,l=a.deleteNum,r=a.deleteNumLong,c=a.netNumLong,m=a.netNum,d=a.list;e.addNum=i,e.addNumLong=s,e.defriendNum=n,e.defriendNumLong=o,e.deleteNum=l,e.deleteNumLong=r,e.netNumLong=c,e.netNum=m;var u=[],p=[],h=[],g=[],f=[];if(d&&0!=d.length)return e.statisticsShow=!0,d.forEach((function(e){u.push(e.time),p.push(e.addNumRange),h.push(e.defriendNumRange),g.push(e.deleteNumRange),f.push(e.netNumRange)})),e.options.xAxis.data=u,e.options.series=e.options.series.map((function(e){return"新增客户数"==e.name?e.data=p:"删除人数"==e.name?e.data=g:"被客户删除/拉黑人数"==e.name?e.data=h:e.data=f,e})),!0;e.statisticsShow=!1}))},changeType:function(e){this.type=e,this.getStatistics(),this.getStatisticsIndex()},dateChange:function(e,t){this.startTime=t[0],this.endTime=t[1],t[0]&&t[1]?this.time=[o()(this.startTime,"YYYY-MM-DD"),o()(this.endTime,"YYYY-MM-DD")]:this.time=null},handleTableChange:function(e){var t=e.current,a=e.pageSize;this.pagination.current=t,this.pagination.pageSize=a,this.getStatisticsIndex()}}},c=r,m=(a("b209"),a("2877")),d=Object(m["a"])(c,i,s,!1,null,"3e94c2ba",null);t["default"]=d.exports}}]);