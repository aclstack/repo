(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user"],{"0cbc":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pass-word"},[a("a-card",[a("a-form-model",{ref:"ruleForm",staticClass:"pass-model",attrs:{model:e.form,"label-col":{span:5},"wrapper-col":{span:12}}},[a("a-form-model-item",{attrs:{label:"手机号码："}},[a("h3",[e._v(e._s(e.userPhone))])]),a("a-form-model-item",{attrs:{label:"旧密码："}},[a("a-input",{model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),a("a-form-model-item",{attrs:{label:"新密码："}},[a("a-input",{model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1),a("a-form-model-item",{attrs:{label:"确认新密码："}},[a("a-input",{model:{value:e.form.againNewPassword,callback:function(t){e.$set(e.form,"againNewPassword",t)},expression:"form.againNewPassword"}})],1),a("div",{staticClass:"footer"},[a("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/passwordUpdate/index@save",expression:"'/passwordUpdate/index@save'"}],attrs:{type:"primary"},on:{click:e.updatePassWord}},[e._v("保存")])],1)],1)],1)],1)},r=[],n=a("5530"),o=a("b775");function i(e){return Object(o["b"])({url:"/user/passwordUpdate",method:"put",data:e})}var l=a("5880"),u={computed:Object(n["a"])({},Object(l["mapGetters"])(["userInfo"])),data:function(){return{userPhone:"",form:{}}},created:function(){var e=this,t=this.userInfo?0:2e3;setTimeout((function(){e.userPhone=e.userInfo.userPhone}),t)},methods:{updatePassWord:function(){var e=this;i(this.form).then((function(t){e.$store.dispatch("Logout").then((function(){e.$router.push({name:"login"})}))}))}}},d=u,c=(a("33ff"),a("2877")),p=Object(c["a"])(d,s,r,!1,null,"1a8925d4",null);t["default"]=p.exports},"33ff":function(e,t,a){"use strict";a("9048")},5690:function(e,t,a){},"69b8":function(e,t,a){"use strict";a("5690")},9048:function(e,t,a){},e382:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=this,a=t.$createElement,s=t._self._c||a;return s("div",[s("a-card",[s("div",{staticClass:"table-page-search-wrapper"},[s("a-form",[s("a-row",{attrs:{gutter:16}},[s("a-col",{attrs:{lg:8}},[s("a-form-item",{attrs:{label:"手机号码：",labelCol:{lg:{span:7}},wrapperCol:{lg:{span:14}}}},[s("a-input",{model:{value:t.screenData.phone,callback:function(e){t.$set(t.screenData,"phone",e)},expression:"screenData.phone"}})],1)],1),s("a-col",{attrs:{lg:8}},[s("a-form-item",{attrs:{label:"状态：",labelCol:{lg:{span:7}},wrapperCol:{lg:{span:14}}}},[s("a-select",{model:{value:t.screenData.status,callback:function(e){t.$set(t.screenData,"status",e)},expression:"screenData.status"}},t._l(t.statusList,(function(e){return s("a-select-option",{key:e.value},[t._v(" "+t._s(e.label)+" ")])})),1)],1)],1),s("a-col",{attrs:{lg:8}},[s("a-form-item",{attrs:{label:"",labelCol:{lg:{span:7}},wrapperCol:{lg:{span:14}}}},[s("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/user/index@search",expression:"'/user/index@search'"}],attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),s("a-button",{staticStyle:{marginLeft:"5px"},on:{click:function(){e.screenData={}}}},[t._v("重置")])],1)],1)],1)],1),s("div",{staticClass:"alter"},[s("a-icon",{attrs:{theme:"twoTone",type:"question-circle"}}),s("span",[t._v("已启用"),s("span",{staticStyle:{color:"#4BA9FF"}},[t._v(t._s(t.usingNum))]),t._v(" 项 未启用:"),s("span",{staticStyle:{color:"#757E82"}},[t._v(t._s(t.forbiddenNum))]),t._v("人")]),s("a-button",{attrs:{type:"link"},on:{click:t.statusModal}},[t._v("启用")]),s("a-modal",{attrs:{visible:t.statusModalDis},on:{cancel:function(){e.statusModalDis=!1}}},[s("p",[t._v("是否确认启用")]),s("template",{slot:"footer"},[s("a-button",{key:"back",on:{click:function(){e.statusModalDis=!1}}},[t._v(" 取消 ")]),s("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.status}},[t._v(" 确定 ")])],1)],2)],1)],1),s("div",{staticClass:"table-wrapper"},[s("a-button",{directives:[{name:"permission",rawName:"v-permission",value:"/user/index@add",expression:"'/user/index@add'"}],attrs:{type:"primary"},on:{click:t.addPopupBtn}},[t._v(" + 添加")]),s("a-table",{attrs:{columns:t.columns,"data-source":t.tableData,rowKey:function(e){return e.userId},"row-selection":{selectedRowKeys:t.userIdList,onChange:t.onSelectChange},pagination:t.pagination},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"department",fn:function(e,a){return s("div",{},t._l(a.department,(function(e){return s("div",{key:e.departmentId},[t._v(t._s(e.departmentName))])})),0)}},{key:"action",fn:function(e,a){return s("div",{},[s("a",{on:{click:function(e){return t.editSubManagement(a.userId)}}},[t._v("修改")]),s("a-divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.rowResetBtn(a)}}},[t._v("重置密码")])],1)}}])})],1),s("a-modal",{attrs:{visible:t.modalVisible,maskClosable:!1,title:"基础信息"},on:{cancel:t.reset}},[s("a-form-model",{ref:"ruleForm",attrs:{model:t.userData,rules:t.rules,"label-col":{span:6},"wrapper-col":{span:16}}},[s("a-form-model-item",{attrs:{label:"员工姓名:",prop:"userName"}},[s("a-input",{model:{value:t.userData.userName,callback:function(e){t.$set(t.userData,"userName",e)},expression:"userData.userName"}})],1),s("a-form-model-item",{staticStyle:{position:"relative"},attrs:{label:"手机号码：",prop:"phone"}},[s("a-input",{on:{blur:t.phoneSelect},model:{value:t.userData.phone,callback:function(e){t.$set(t.userData,"phone",e)},expression:"userData.phone"}}),s("span",{staticStyle:{position:"absolute",left:"5px",top:"20px",color:"#a9a9a9"}},[t._v("输入的手机号需与企业微信中员工的手机号一致")])],1),t.addShowPopup?s("a-form-model-item",{attrs:{label:"密码：",prop:"password"}},[s("a-input",{attrs:{type:"password"},model:{value:t.userData.password,callback:function(e){t.$set(t.userData,"password",e)},expression:"userData.password"}})],1):t._e(),t.addShowPopup?s("a-form-model-item",{attrs:{label:"确认密码：",prop:"confirmPass"}},[s("a-input",{attrs:{type:"password"},model:{value:t.userData.confirmPass,callback:function(e){t.$set(t.userData,"confirmPass",e)},expression:"userData.confirmPass"}})],1):t._e(),s("a-form-model-item",{attrs:{label:"性别：",prop:"gender"}},[s("a-radio-group",{model:{value:t.userData.gender,callback:function(e){t.$set(t.userData,"gender",e)},expression:"userData.gender"}},[s("a-radio",{attrs:{value:1}},[t._v(" 男 ")]),s("a-radio",{attrs:{value:2}},[t._v(" 女 ")])],1)],1),s("a-form-model-item",{attrs:{label:"状态",prop:"status"}},[s("a-radio-group",{model:{value:t.userData.status,callback:function(e){t.$set(t.userData,"status",e)},expression:"userData.status"}},[s("a-radio",{attrs:{value:1}},[t._v(" 正常 ")]),s("a-radio",{attrs:{value:2}},[t._v(" 禁用 ")]),s("a-radio",{attrs:{value:0}},[t._v(" 未启用 ")])],1)],1),s("div",{staticClass:"role-box"},[s("a-form-model-item",{attrs:{label:"部门"}},t._l(t.departmentList,(function(e){return 0!==t.departmentList.length?s("a-tooltip",{key:e.workDepartmentId},[s("template",{slot:"title"},[t._v(" "+t._s(e.workDepartmentName)+" ")]),s("div",{staticClass:"name"},[t._v(t._s(e.workDepartmentName))])],2):t._e()})),1),s("a-form-model-item",{attrs:{label:"角色",prop:"roleId"}},[s("a-select",{model:{value:t.userData.roleId,callback:function(e){t.$set(t.userData,"roleId",e)},expression:"userData.roleId"}},t._l(t.roleList,(function(e){return s("a-select-option",{key:e.roleId,attrs:{disabled:0==e.roleId}},[t._v(" "+t._s(e.name)+" ")])})),1)],1)],1)],1),s("template",{slot:"footer"},[s("a-button",{key:"submit",attrs:{loading:t.btnLoading,type:"primary"},on:{click:t.addSubManagement}},[t._v(" 确定 ")]),s("a-button",{key:"back",on:{click:t.reset}},[t._v(" 取消 ")])],1)],2)],1),s("a-modal",{attrs:{title:"重置密码",footer:null,maskClosable:!1,width:"450px"},on:{cancel:t.cancelBtn},model:{value:t.resetPopup,callback:function(e){t.resetPopup=e},expression:"resetPopup"}},[s("div",{staticStyle:{display:"flex","justify-content":"center"}},[s("div",{staticStyle:{"line-height":"31px",width:"75px","text-align":"right"}},[t._v("新密码：")]),s("a-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请输入新密码",type:"password"},model:{value:t.resetPassData.newPassword,callback:function(e){t.$set(t.resetPassData,"newPassword",e)},expression:"resetPassData.newPassword"}})],1),s("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"15px"}},[s("div",{staticStyle:{"line-height":"31px",width:"75px","text-align":"right"}},[t._v("确认密码：")]),s("a-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请再次确认密码",type:"password"},model:{value:t.resetPassData.confirmPassword,callback:function(e){t.$set(t.resetPassData,"confirmPassword",e)},expression:"resetPassData.confirmPassword"}})],1),s("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"15px"}},[s("a-button",{staticStyle:{"margin-right":"40px"},on:{click:t.cancelBtn}},[t._v("取消")]),s("a-button",{attrs:{type:"primary"},on:{click:t.confirmReset}},[t._v("确认修改")])],1)])],1)},r=[],n=(a("a15b"),a("ac1f"),a("b775"));function o(e){return Object(n["b"])({url:"/user/index",method:"get",params:e})}function i(e){return Object(n["b"])({url:"/user/store",method:"post",data:e})}function l(e){return Object(n["b"])({url:"/user/update",method:"put",data:e})}function u(e){return Object(n["b"])({url:"/user/show",method:"get",params:e})}function d(e){return Object(n["b"])({url:"/user/statusUpdate",method:"put",data:e})}function c(e){return Object(n["b"])({url:"/workDepartment/selectByPhone",method:"get",params:e})}function p(e){return Object(n["b"])({url:"/role/select",method:"get",params:e})}function m(e){return Object(n["b"])({url:"/user/passwordReset",method:"put",data:e})}var f={data:function(){return{resetPopup:!1,resetPassData:{newPassword:"",confirmPassword:""},resetRowId:"",addShowPopup:!0,btnLoading:!1,screenData:{},modalVisible:!1,columns:[{title:"企业成员",dataIndex:"userName",align:"center"},{title:"所属部门",dataIndex:"department",align:"center",scopedSlots:{customRender:"department"}},{title:"职务",dataIndex:"roleName",align:"center"},{title:"手机号（登录账号）",dataIndex:"phone",align:"center"},{title:"状态",dataIndex:"statusText",align:"center"},{title:"时间",dataIndex:"createdAt",align:"center"},{title:"操作",dataIndex:"action",align:"center",scopedSlots:{customRender:"action"}}],tableData:[],userData:{gender:1,status:0},usingNum:"",forbiddenNum:"",userId:"",pagination:{total:0,current:1,pageSize:10,showSizeChanger:!0},statusList:[{label:"未启用",value:0},{label:"正常",value:1},{label:"禁用",value:2}],userIdList:[],rules:{userName:[{required:!0,message:"请输入员工姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"focus"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],confirmPass:[{required:!0,message:"请再次确认密码",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}]},statusModalDis:!1,departmentList:[],roleList:[]}},created:function(){this.getTableData(),this.getSelectRole()},methods:{cancelBtn:function(){this.resetPopup=!1,this.resetPassData.newPassword="",this.resetPassData.confirmPassword=""},rowResetBtn:function(e){this.resetRowId=e.userId,this.resetPopup=!0},confirmReset:function(){var e=this;return""==this.resetPassData.newPassword?(this.$message.warning("新密码不能为空"),!1):""==this.resetPassData.confirmPassword?(this.$message.warning("请再次确认密码"),!1):this.resetPassData.newPassword!=this.resetPassData.confirmPassword?(this.$message.warning("两次密码不一致，请确认密码"),this.resetPassData.newPassword="",this.resetPassData.confirmPassword="",!1):void m({id:this.resetRowId,newPassword:this.resetPassData.newPassword}).then((function(t){e.$message.success("修改成功"),e.resetPassData={},e.resetPopup=!1}))},addPopupBtn:function(){this.modalVisible=!0,this.addShowPopup=!0},getTableData:function(){var e=this,t={phone:this.screenData.phone,status:this.screenData.status,page:this.pagination.current,perPage:this.pagination.pageSize};o(t).then((function(t){e.usingNum=t.data.normalNum,e.forbiddenNum=t.data.notEnabledNum,e.tableData=t.data.list,e.pagination.total=t.data.page.total}))},search:function(){this.pagination.current=1,this.getTableData()},onSelectChange:function(e){this.userIdList=e},statusModal:function(){0===this.userIdList.length?this.$message.error("请选择要启用的账户"):this.statusModalDis=!0},status:function(){var e=this;d({userId:this.userIdList.join(),status:1}).then((function(t){e.statusModalDis=!1,e.userIdList=[],e.getTableData()}))},phoneSelect:function(){var e=this;if(!/^1[3456789]\d{9}$/.test(this.userData.phone))return this.btnLoading=!1,this.$message.warning("手机号格式错误"),!1;c({phone:this.userData.phone}).then((function(t){e.departmentList=t.data}))},getSelectRole:function(){var e=this,t={roleId:0,name:"请选择"};p().then((function(a){e.roleList=a.data,e.roleList.unshift(t)}))},addSubManagement:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;if(""!==e.userId){if(e.btnLoading=!0,!/^1[3456789]\d{9}$/.test(e.userData.phone))return e.btnLoading=!1,e.$message.warning("手机号格式错误"),!1;l({userId:e.userId,userName:e.userData.userName,phone:e.userData.phone,gender:e.userData.gender,roleId:e.userData.roleId,status:e.userData.status}).then((function(t){e.btnLoading=!1,e.modalVisible=!1,e.userData={gender:1,status:0},e.getTableData()})).catch((function(t){e.modalVisible=!0,e.btnLoading=!1}))}else{if(e.btnLoading=!0,!/^1[3456789]\d{9}$/.test(e.userData.phone))return e.btnLoading=!1,e.$message.warning("手机号格式错误"),!1;if(e.userData.password!=e.userData.confirmPass)return e.btnLoading=!1,e.userData.password="",e.userData.confirmPass="",e.$message.warning("两次密码不一致"),!1;i(e.userData).then((function(t){e.btnLoading=!1,e.modalVisible=!1,e.getTableData(),e.userData={gender:1,status:0}})).catch((function(t){e.modalVisible=!0,e.btnLoading=!1}))}}))},reset:function(){this.modalVisible=!1,this.userData={gender:1,status:0},this.departmentList=[],this.$refs.ruleForm.resetFields()},editSubManagement:function(e){var t=this;this.addShowPopup=!1,u({userId:e}).then((function(e){t.modalVisible=!0,t.userId=e.data.userId,t.userData=e.data,c({phone:t.userData.phone}).then((function(e){t.departmentList=e.data}))}))},handleTableChange:function(e){var t=e.current,a=e.pageSize;this.pagination.current=t,this.pagination.pageSize=a,this.getTableData()}}},h=f,g=(a("69b8"),a("2877")),b=Object(g["a"])(h,s,r,!1,null,"c96900d0",null);t["default"]=b.exports}}]);